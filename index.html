<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PrayLink - Messages Anonymes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        body { font-family: 'Inter', sans-serif; }
        
        .gradient-bg {
            background: linear-gradient(135deg, #1f2937 0%, #374151 100%);
        }
        
        .app-container {
            max-width: 375px;
            margin: 0 auto;
            min-height: 100vh;
            background: white;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        
        @media (max-width: 768px) {
            .app-container {
                max-width: 100%;
                box-shadow: none;
            }
        }
        
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .premium-glow {
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }
        
        .question-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .game-card {
            transition: all 0.3s ease;
        }
        
        .game-card:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .simple-btn {
            transition: background-color 0.2s ease;
            cursor: pointer;
        }
        
        .simple-btn:hover {
            opacity: 0.9;
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #667eea;
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .interactive-btn {
            transition: all 0.3s ease;
        }

        .interactive-btn:hover {
            transform: translateY(-2px);
        }

        .hover\:glow:hover {
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.5);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #2d2d2d;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            z-index: 10000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .pulse-effect {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .bounce-in {
            animation: bounceIn 0.6s ease-out;
        }

        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }

        .setup-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.95);
            z-index: 9999;
            display: none;
            overflow-y: auto;
        }

        .setup-content {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            min-height: 100vh;
            color: white;
        }

        .setup-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .setup-section {
            background: #2d2d2d;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #444;
        }

        .code-block {
            background: #1e1e1e;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            overflow-x: auto;
            margin: 10px 0;
        }

        .setup-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s ease;
        }

        .setup-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .setup-btn.success {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
        }

        .setup-input {
            background: #3d3d3d;
            border: 1px solid #555;
            color: white;
            padding: 10px;
            border-radius: 6px;
            width: 100%;
            margin: 5px 0;
        }

        .setup-textarea {
            background: #3d3d3d;
            border: 1px solid #555;
            color: white;
            padding: 10px;
            border-radius: 6px;
            width: 100%;
            min-height: 200px;
            font-family: 'Courier New', monospace;
            margin: 5px 0;
        }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-online { background: #2ecc71; }
        .status-offline { background: #e74c3c; }
        .status-warning { background: #f39c12; }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Setup Panel -->
    <div id="setupPanel" class="setup-panel">
        <div class="setup-content">
            <!-- Setup Header -->
            <div class="setup-header">
                <div class="flex justify-between items-center">
                    <div>
                        <h1 class="text-3xl font-bold">üöÄ Configuration PrayLink</h1>
                        <p class="opacity-90">Serveur Google Apps Script + Google Sheets</p>
                    </div>
                    <button onclick="closeSetupPanel()" class="setup-btn" style="background: #e74c3c;">
                        ‚úï Fermer
                    </button>
                </div>
            </div>

            <!-- √âtape 1: Google Sheets -->
            <div class="setup-section">
                <h2 class="text-xl font-bold mb-4">üìä √âtape 1: Cr√©er Google Sheets</h2>
                
                <p class="mb-4">1. Allez sur <a href="https://sheets.google.com" target="_blank" class="text-blue-400 underline">Google Sheets</a></p>
                <p class="mb-4">2. Cr√©ez un nouveau document nomm√© "PrayLink Database"</p>
                <p class="mb-4">3. Cr√©ez ces feuilles (onglets) :</p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div class="bg-gray-800 p-4 rounded">
                        <h4 class="font-bold mb-2">üìã Feuille "Users"</h4>
                        <div class="text-sm">
                            <div>A1: id</div>
                            <div>B1: username</div>
                            <div>C1: platform</div>
                            <div>D1: profileEmoji</div>
                            <div>E1: createdAt</div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-800 p-4 rounded">
                        <h4 class="font-bold mb-2">üí¨ Feuille "Messages"</h4>
                        <div class="text-sm">
                            <div>A1: id</div>
                            <div>B1: recipient</div>
                            <div>C1: type</div>
                            <div>D1: content</div>
                            <div>E1: sender</div>
                            <div>F1: createdAt</div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-800 p-4 rounded">
                        <h4 class="font-bold mb-2">üìñ Feuille "Verses"</h4>
                        <div class="text-sm">
                            <div>A1: id</div>
                            <div>B1: text</div>
                            <div>C1: reference</div>
                            <div>D1: category</div>
                            <div>E1: language</div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-800 p-4 rounded">
                        <h4 class="font-bold mb-2">üìä Feuille "Stats"</h4>
                        <div class="text-sm">
                            <div>A1: metric</div>
                            <div>B1: value</div>
                            <div>C1: updatedAt</div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">URL de votre Google Sheets :</label>
                    <input type="text" id="sheetsUrl" class="setup-input" placeholder="https://docs.google.com/spreadsheets/d/YOUR_SHEET_ID/edit">
                </div>
                
                <button onclick="validateSheetsUrl()" class="setup-btn success">‚úÖ Valider Google Sheets</button>
            </div>

            <!-- √âtape 2: Google Apps Script -->
            <div class="setup-section">
                <h2 class="text-xl font-bold mb-4">‚öôÔ∏è √âtape 2: Google Apps Script</h2>
                
                <p class="mb-4">1. Allez sur <a href="https://script.google.com" target="_blank" class="text-blue-400 underline">Google Apps Script</a></p>
                <p class="mb-4">2. Cr√©ez un nouveau projet nomm√© "PrayLink API"</p>
                <p class="mb-4">3. Remplacez le code par d√©faut par celui ci-dessous :</p>
                
                <textarea class="setup-textarea" id="appsScriptCode" readonly>
// PrayLink Google Apps Script API
// Remplacez YOUR_SHEET_ID par l'ID de votre Google Sheets

const SHEET_ID = 'YOUR_SHEET_ID'; // √Ä remplacer !

function doPost(e) {
  try {
    const data = JSON.parse(e.postData.contents);
    const action = data.action;
    
    switch(action) {
      case 'auth/register':
        return registerUser(data.data);
      case 'messages':
        return getMessages(data.data);
      case 'messages/send':
        return sendMessage(data.data);
      case 'verses':
        return getVerses();
      case 'admin/stats':
        return getStats();
      default:
        return ContentService
          .createTextOutput(JSON.stringify({error: 'Action non reconnue'}))
          .setMimeType(ContentService.MimeType.JSON);
    }
  } catch(error) {
    return ContentService
      .createTextOutput(JSON.stringify({error: error.toString()}))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

function doGet(e) {
  return ContentService
    .createTextOutput(JSON.stringify({status: 'PrayLink API Active', version: '1.0.0'}))
    .setMimeType(ContentService.MimeType.JSON);
}

// Fonction pour enregistrer un utilisateur
function registerUser(userData) {
  const sheet = SpreadsheetApp.openById(SHEET_ID).getSheetByName('Users');
  const id = Utilities.getUuid();
  const timestamp = new Date().toISOString();
  
  sheet.appendRow([
    id,
    userData.username,
    userData.platform,
    userData.profileEmoji,
    timestamp
  ]);
  
  return ContentService
    .createTextOutput(JSON.stringify({success: true, id: id}))
    .setMimeType(ContentService.MimeType.JSON);
}

// Fonction pour r√©cup√©rer les messages
function getMessages(username) {
  const sheet = SpreadsheetApp.openById(SHEET_ID).getSheetByName('Messages');
  const data = sheet.getDataRange().getValues();
  const headers = data[0];
  const messages = [];
  
  for (let i = 1; i < data.length; i++) {
    const row = data[i];
    if (row[1] === username) { // recipient column
      messages.push({
        _id: row[0],
        recipient: row[1],
        type: row[2],
        content: row[3],
        sender: row[4],
        createdAt: row[5]
      });
    }
  }
  
  return ContentService
    .createTextOutput(JSON.stringify(messages))
    .setMimeType(ContentService.MimeType.JSON);
}

// Fonction pour envoyer un message
function sendMessage(messageData) {
  const sheet = SpreadsheetApp.openById(SHEET_ID).getSheetByName('Messages');
  const id = Utilities.getUuid();
  const timestamp = new Date().toISOString();
  
  sheet.appendRow([
    id,
    messageData.recipient,
    messageData.type,
    messageData.content,
    messageData.sender || 'Anonyme',
    timestamp
  ]);
  
  // Mettre √† jour les stats
  updateStats('messages', 1);
  
  return ContentService
    .createTextOutput(JSON.stringify({success: true, id: id}))
    .setMimeType(ContentService.MimeType.JSON);
}

// Fonction pour r√©cup√©rer les versets
function getVerses() {
  const sheet = SpreadsheetApp.openById(SHEET_ID).getSheetByName('Verses');
  const data = sheet.getDataRange().getValues();
  const verses = [];
  
  // Si pas de versets, en cr√©er quelques-uns
  if (data.length <= 1) {
    const defaultVerses = [
      ['1', 'Car Dieu a tant aim√© le monde qu\'il a donn√© son Fils unique, afin que quiconque croit en lui ne p√©risse point, mais qu\'il ait la vie √©ternelle.', 'Jean 3:16', 'amour', 'fr'],
      ['2', 'Je puis tout par celui qui me fortifie.', 'Philippiens 4:13', 'force', 'fr'],
      ['3', 'Venez √† moi, vous tous qui √™tes fatigu√©s et charg√©s, et je vous donnerai du repos.', 'Matthieu 11:28', 'paix', 'fr']
    ];
    
    defaultVerses.forEach(verse => {
      sheet.appendRow(verse);
    });
    
    return ContentService
      .createTextOutput(JSON.stringify(defaultVerses.map(v => ({
        id: v[0],
        text: v[1],
        ref: v[2],
        category: v[3],
        language: v[4]
      }))))
      .setMimeType(ContentService.MimeType.JSON);
  }
  
  for (let i = 1; i < data.length; i++) {
    const row = data[i];
    verses.push({
      id: row[0],
      text: row[1],
      ref: row[2],
      category: row[3],
      language: row[4]
    });
  }
  
  return ContentService
    .createTextOutput(JSON.stringify(verses))
    .setMimeType(ContentService.MimeType.JSON);
}

// Fonction pour r√©cup√©rer les statistiques
function getStats() {
  const usersSheet = SpreadsheetApp.openById(SHEET_ID).getSheetByName('Users');
  const messagesSheet = SpreadsheetApp.openById(SHEET_ID).getSheetByName('Messages');
  const versesSheet = SpreadsheetApp.openById(SHEET_ID).getSheetByName('Verses');
  
  const stats = {
    users: Math.max(0, usersSheet.getLastRow() - 1),
    messages: Math.max(0, messagesSheet.getLastRow() - 1),
    verses: Math.max(0, versesSheet.getLastRow() - 1),
    uptime: '99.9'
  };
  
  return ContentService
    .createTextOutput(JSON.stringify(stats))
    .setMimeType(ContentService.MimeType.JSON);
}

// Fonction pour mettre √† jour les statistiques
function updateStats(metric, increment) {
  // Optionnel: pour des stats plus d√©taill√©es
  const sheet = SpreadsheetApp.openById(SHEET_ID).getSheetByName('Stats');
  // Impl√©mentation des stats d√©taill√©es si n√©cessaire
}
                </textarea>
                
                <div class="mt-4 space-y-2">
                    <p class="text-sm">4. Remplacez <code class="bg-gray-800 px-2 py-1 rounded">YOUR_SHEET_ID</code> par l'ID de votre Google Sheets</p>
                    <p class="text-sm">5. Cliquez sur "D√©ployer" ‚Üí "Nouveau d√©ploiement"</p>
                    <p class="text-sm">6. Type: "Application web"</p>
                    <p class="text-sm">7. Acc√®s: "Tout le monde"</p>
                    <p class="text-sm">8. Copiez l'URL du d√©ploiement</p>
                </div>
                
                <div class="mt-4">
                    <label class="block text-sm font-medium mb-2">URL de votre Google Apps Script :</label>
                    <input type="text" id="scriptUrl" class="setup-input" placeholder="https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec">
                </div>
                
                <button onclick="validateScriptUrl()" class="setup-btn success">‚úÖ Valider Apps Script</button>
            </div>

            <!-- √âtape 3: Configuration finale -->
            <div class="setup-section">
                <h2 class="text-xl font-bold mb-4">üéØ √âtape 3: Configuration finale</h2>
                
                <div class="mb-4">
                    <h4 class="font-semibold mb-2">√âtat de la configuration :</h4>
                    <div class="space-y-2">
                        <div class="flex items-center">
                            <span class="status-indicator status-offline" id="sheetsStatus"></span>
                            <span>Google Sheets configur√©</span>
                        </div>
                        <div class="flex items-center">
                            <span class="status-indicator status-offline" id="scriptStatus"></span>
                            <span>Google Apps Script d√©ploy√©</span>
                        </div>
                        <div class="flex items-center">
                            <span class="status-indicator status-offline" id="connectionStatus"></span>
                            <span>Connexion test√©e</span>
                        </div>
                    </div>
                </div>
                
                <div class="flex space-x-3">
                    <button onclick="testConnection()" class="setup-btn">üîç Tester la connexion</button>
                    <button onclick="initializeDatabase()" class="setup-btn success">üöÄ Initialiser la base</button>
                    <button onclick="finishSetup()" class="setup-btn success">‚úÖ Terminer la configuration</button>
                </div>
            </div>
        </div>
    </div>

    <div class="app-container">
        
        <!-- Page 1: Accueil -->
        <div id="welcomePage" class="gradient-bg h-screen flex flex-col justify-center items-center text-white p-8">
            <div class="text-center mb-12">
                <div class="w-32 h-32 bg-white rounded-full mx-auto mb-6 flex items-center justify-center text-6xl">
                    üôè
                </div>
                <h1 class="text-4xl font-bold mb-4">PrayLink</h1>
                <p class="text-lg opacity-90">Messages anonymes bibliques</p>
            </div>
            
            <div class="w-full max-w-sm">
                <button onclick="goToPage('platformPage')" class="w-full bg-white text-gray-900 font-bold py-4 px-6 rounded-2xl text-lg mb-6 shadow-lg simple-btn">
                    üöÄ D√©marrer
                </button>
                
                <div class="text-center text-sm opacity-75">
                    <p class="mb-2">En continuant, vous acceptez les</p>
                    <a href="#" class="underline">Conditions d'utilisation</a>
                </div>
            </div>
            
            <!-- Bouton de configuration (cach√©) -->
            <button onclick="openSetupPanel()" class="fixed bottom-4 right-4 bg-blue-600 text-white p-3 rounded-full shadow-lg" style="display: none;" id="setupBtn">
                ‚öôÔ∏è
            </button>
        </div>

        <!-- Page 2: Choix de plateforme -->
        <div id="platformPage" class="hidden h-screen bg-white p-6 flex flex-col">
            <div class="flex items-center mb-8">
                <button onclick="goToPage('welcomePage')" class="text-2xl simple-btn">‚Üê</button>
                <h2 class="text-xl font-semibold ml-4">Choisir une plateforme</h2>
            </div>
            
            <div class="flex-1 flex flex-col justify-center">
                <p class="text-center text-gray-600 mb-8">Sous quel nom veux-tu utiliser PrayLink ?</p>
                
                <div class="space-y-4 mb-8">
                    <button onclick="selectPlatform('instagram')" class="w-full flex items-center justify-between p-4 border-2 border-gray-200 rounded-xl simple-btn">
                        <div class="flex items-center">
                            <div class="w-12 h-12 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl flex items-center justify-center text-white text-xl mr-4">
                                üì∑
                            </div>
                            <span class="font-medium">Instagram</span>
                        </div>
                        <span class="text-gray-400 text-2xl">‚Üí</span>
                    </button>
                    
                    <button onclick="selectPlatform('whatsapp')" class="w-full flex items-center justify-between p-4 border-2 border-gray-200 rounded-xl simple-btn">
                        <div class="flex items-center">
                            <div class="w-12 h-12 bg-green-500 rounded-xl flex items-center justify-center text-white text-xl mr-4">
                                üì±
                            </div>
                            <span class="font-medium">WhatsApp</span>
                        </div>
                        <span class="text-gray-400 text-2xl">‚Üí</span>
                    </button>
                    
                    <button onclick="selectPlatform('snapchat')" class="w-full flex items-center justify-between p-4 border-2 border-gray-200 rounded-xl simple-btn">
                        <div class="flex items-center">
                            <div class="w-12 h-12 bg-yellow-400 rounded-xl flex items-center justify-center text-gray-800 text-xl mr-4">
                                üëª
                            </div>
                            <span class="font-medium">Snapchat</span>
                        </div>
                        <span class="text-gray-400 text-2xl">‚Üí</span>
                    </button>
                </div>
                
                <button onclick="goToPage('usernamePage')" class="w-full bg-gray-900 text-white font-semibold py-4 rounded-xl simple-btn">
                    Continuer
                </button>
            </div>
        </div>

        <!-- Page 3: Nom d'utilisateur -->
        <div id="usernamePage" class="hidden h-screen bg-white p-6 flex flex-col">
            <div class="flex items-center mb-8">
                <button onclick="goToPage('platformPage')" class="text-2xl interactive-btn">‚Üê</button>
                <h2 class="text-xl font-semibold ml-4">Nom d'utilisateur</h2>
            </div>
            
            <div class="flex-1 flex flex-col justify-center">
                <p class="text-center text-gray-600 mb-8">Choisis ton nom d'utilisateur</p>
                
                <div class="mb-6">
                    <input type="text" id="usernameInput" placeholder="@tonnom" 
                           class="w-full px-4 py-4 border-2 border-gray-200 rounded-xl text-lg focus:border-gray-900 focus:outline-none">
                </div>
                
                <button onclick="goToPage('profilePhotoPage')" class="w-full bg-gray-900 text-white font-semibold py-4 rounded-xl mb-4 interactive-btn hover:glow">
                    Continuer
                </button>
            </div>
        </div>

        <!-- Page 4: Photo de profil -->
        <div id="profilePhotoPage" class="hidden h-screen bg-white p-6 flex flex-col">
            <div class="flex items-center mb-8">
                <button onclick="goToPage('usernamePage')" class="text-2xl interactive-btn">‚Üê</button>
                <h2 class="text-xl font-semibold ml-4">Photo de profil</h2>
            </div>
            
            <div class="flex-1 flex flex-col justify-center items-center">
                <p class="text-center text-gray-600 mb-8">Choisis une photo pour ton profil</p>
                
                <div class="w-32 h-32 bg-gray-200 rounded-full mb-8 flex items-center justify-center text-4xl cursor-pointer simple-btn" onclick="selectProfilePhoto()">
                    <span id="profileEmoji">üì∑</span>
                </div>
                
                <div class="grid grid-cols-4 gap-4 mb-8">
                    <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center text-2xl cursor-pointer simple-btn" onclick="setProfileEmoji('üôè')">üôè</div>
                    <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center text-2xl cursor-pointer simple-btn" onclick="setProfileEmoji('‚ú®')">‚ú®</div>
                    <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center text-2xl cursor-pointer simple-btn" onclick="setProfileEmoji('üí´')">üí´</div>
                    <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center text-2xl cursor-pointer simple-btn" onclick="setProfileEmoji('üåü')">üåü</div>
                    <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center text-2xl cursor-pointer simple-btn" onclick="setProfileEmoji('üíù')">üíù</div>
                    <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center text-2xl cursor-pointer simple-btn" onclick="setProfileEmoji('üïäÔ∏è')">üïäÔ∏è</div>
                    <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center text-2xl cursor-pointer simple-btn" onclick="setProfileEmoji('üëº')">üëº</div>
                    <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center text-2xl cursor-pointer simple-btn" onclick="setProfileEmoji('üéØ')">üéØ</div>
                </div>
                
                <div class="w-full space-y-3">
                    <button onclick="goToPage('premiumPage')" class="w-full bg-gray-900 text-white font-semibold py-4 rounded-xl interactive-btn hover:glow">
                        Continuer
                    </button>
                    <button onclick="goToPage('premiumPage')" class="w-full text-gray-500 py-2 interactive-btn">
                        Ignorer
                    </button>
                </div>
            </div>
        </div>

        <!-- Page 5: Acc√®s illimit√© -->
        <div id="premiumPage" class="hidden h-screen bg-white p-6 flex flex-col">
            <div class="flex items-center justify-between mb-8">
                <button onclick="goToPage('profilePhotoPage')" class="text-2xl interactive-btn">‚Üê</button>
                <button onclick="goToPage('mainPage')" class="text-purple-600 font-medium interactive-btn">Passer</button>
            </div>
            
            <div class="flex-1 flex flex-col justify-center">
                <div class="text-center mb-8">
                    <div class="w-24 h-24 bg-gradient-to-r from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center text-4xl premium-glow pulse-effect">
                        üëë
                    </div>
                    <h2 class="text-2xl font-bold mb-2">Acc√®s illimit√©</h2>
                    <p class="text-gray-600">D√©bloquez toutes les fonctionnalit√©s premium</p>
                </div>
                
                <div class="space-y-4 mb-8">
                    <div class="flex items-center p-4 bg-yellow-50 rounded-xl">
                        <span class="text-2xl mr-4">üéÆ</span>
                        <span class="font-medium">100 jeux bibliques exclusifs</span>
                    </div>
                    <div class="flex items-center p-4 bg-blue-50 rounded-xl">
                        <span class="text-2xl mr-4">üèÜ</span>
                        <span class="font-medium">3 niveaux de difficult√©</span>
                    </div>
                    <div class="flex items-center p-4 bg-purple-50 rounded-xl">
                        <span class="text-2xl mr-4">üìä</span>
                        <span class="font-medium">Suivi de progression</span>
                    </div>
                </div>
                
                <button onclick="goToPage('mainPage')" class="w-full bg-gray-900 text-white font-bold py-4 rounded-xl mb-4 interactive-btn hover:glow">
                    Continuer
                </button>
            </div>
        </div>

        <!-- Page 6: Page principale -->
        <div id="mainPage" class="hidden h-screen bg-white flex flex-col">
            <!-- Header -->
            <div class="flex items-center justify-between p-4 border-b">
                <h1 class="text-xl font-bold">PrayLink</h1>
                <div class="flex items-center space-x-4">
                    <button onclick="goToPage('inboxPage')" class="relative interactive-btn">
                        <span class="text-2xl">üì¨</span>
                        <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center pulse-effect" id="messageCount">0</span>
                    </button>
                    <button onclick="openSetupPanel()" class="text-2xl interactive-btn">‚öôÔ∏è</button>
                </div>
            </div>
            
            <!-- Navigation -->
            <div class="flex border-b">
                <button onclick="showTab('play')" class="flex-1 py-4 text-center font-medium border-b-2 border-gray-900 text-gray-900 interactive-btn" id="playTab">
                    Play
                </button>
                <button onclick="showTab('games')" class="flex-1 py-4 text-center font-medium text-gray-500 interactive-btn" id="gamesTab">
                    Jeux
                </button>
                <button onclick="showTab('inbox')" class="flex-1 py-4 text-center font-medium text-gray-500 interactive-btn" id="inboxTab">
                    Inbox
                </button>
            </div>
            
            <!-- Play Content -->
            <div id="playContent" class="flex-1 flex flex-col overflow-y-auto">
                <!-- Profil principal -->
                <div class="p-6 border-b bg-white">
                    <div class="flex items-center mb-4">
                        <div class="w-20 h-20 bg-gradient-to-br from-gray-700 to-gray-900 rounded-full flex items-center justify-center text-3xl shadow-lg mr-4 pulse-effect">
                            <span id="mainProfileEmoji">üôè</span>
                        </div>
                        <div class="flex-1">
                            <h2 class="text-xl font-bold mb-1" id="mainUsername">@PrayerWarrior</h2>
                            <p class="text-gray-600 text-sm">Messages anonymes bibliques üìñ</p>
                        </div>
                    </div>
                    
                    <div class="flex space-x-6">
                        <div class="text-center">
                            <div class="text-lg font-bold text-gray-900" id="userMessagesCount">0</div>
                            <div class="text-xs text-gray-500">Messages</div>
                        </div>
                        <div class="text-center">
                            <div class="text-lg font-bold text-gray-900" id="userPrayersCount">0</div>
                            <div class="text-xs text-gray-500">Pri√®res</div>
                        </div>
                        <div class="text-center">
                            <div class="text-lg font-bold text-gray-900" id="userTestimoniesCount">0</div>
                            <div class="text-xs text-gray-500">T√©moignages</div>
                        </div>
                    </div>
                </div>
                
                <!-- Choix Questions ou Versets -->
                <div class="p-6 bg-white">
                    <h3 class="text-lg font-semibold text-center mb-6">Que veux-tu partager ?</h3>
                    
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <!-- Bouton Questions -->
                        <button onclick="openQuestionsModal()" class="bg-gradient-to-br from-purple-500 to-pink-600 text-white p-6 rounded-2xl text-center hover:shadow-lg transition-all interactive-btn">
                            <div class="text-4xl mb-3">‚ùì</div>
                            <h4 class="font-bold text-lg mb-2">Questions</h4>
                            <p class="text-sm opacity-90">Questions bibliques √† partager</p>
                        </button>
                        
                        <!-- Bouton Versets -->
                        <button onclick="openVersetsModal()" class="bg-gradient-to-br from-blue-500 to-indigo-600 text-white p-6 rounded-2xl text-center hover:shadow-lg transition-all interactive-btn">
                            <div class="text-4xl mb-3">üìñ</div>
                            <h4 class="font-bold text-lg mb-2">Versets</h4>
                            <p class="text-sm opacity-90">Versets inspirants √† partager</p>
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <!-- Bouton Pri√®res -->
                        <button onclick="openPrayersModal()" class="bg-gradient-to-br from-green-500 to-emerald-600 text-white p-6 rounded-2xl text-center hover:shadow-lg transition-all interactive-btn">
                            <div class="text-4xl mb-3">üôè</div>
                            <h4 class="font-bold text-lg mb-2">Pri√®res</h4>
                            <p class="text-sm opacity-90">Demandes de pri√®res anonymes</p>
                        </button>
                        
                        <!-- Bouton T√©moignages -->
                        <button onclick="openTestimoniesModal()" class="bg-gradient-to-br from-orange-500 to-red-600 text-white p-6 rounded-2xl text-center hover:shadow-lg transition-all interactive-btn">
                            <div class="text-4xl mb-3">‚ú®</div>
                            <h4 class="font-bold text-lg mb-2">T√©moignages</h4>
                            <p class="text-sm opacity-90">Partage tes t√©moignages</p>
                        </button>
                    </div>
                </div>
                
                <!-- Section Statistiques -->
                <div class="p-6 bg-gray-50">
                    <h3 class="text-lg font-semibold mb-4">Tes partages</h3>
                    <div class="grid grid-cols-3 gap-4">
                        <div class="bg-white p-4 rounded-xl text-center">
                            <div class="text-2xl font-bold text-purple-600" id="questionsShared">0</div>
                            <div class="text-xs text-gray-500">Questions partag√©es</div>
                        </div>
                        <div class="bg-white p-4 rounded-xl text-center">
                            <div class="text-2xl font-bold text-blue-600" id="versesShared">0</div>
                            <div class="text-xs text-gray-500">Versets partag√©s</div>
                        </div>
                        <div class="bg-white p-4 rounded-xl text-center">
                            <div class="text-2xl font-bold text-green-600" id="responsesReceived">0</div>
                            <div class="text-xs text-gray-500">R√©ponses re√ßues</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Games Content -->
            <div id="gamesContent" class="hidden flex-1 p-4 overflow-y-auto">
                <div class="text-center mb-6">
                    <h3 class="text-lg font-semibold mb-2">Jeux Bibliques</h3>
                    <p class="text-gray-600 text-sm">D√©couvre la Bible en t'amusant !</p>
                </div>
                
                <!-- Jeux Gratuits -->
                <div class="mb-6">
                    <h4 class="text-md font-semibold text-gray-700 mb-3 flex items-center">
                        <span class="text-green-600 mr-2">üÜì</span>
                        Jeux Gratuits
                    </h4>
                    
                    <div class="space-y-4">
                        <div class="bg-gradient-to-r from-gray-700 to-gray-900 rounded-2xl p-6 text-white">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <h4 class="text-lg font-bold">üìñ Quiz Biblique</h4>
                                    <p class="text-sm opacity-90">Teste tes connaissances</p>
                                </div>
                                <div class="text-3xl pulse-effect">üß†</div>
                            </div>
                            <button onclick="startBibleQuiz()" class="w-full bg-white bg-opacity-20 text-white font-semibold py-3 rounded-xl hover:bg-opacity-30 transition-all interactive-btn bounce-in">
                                üéÆ Jouer maintenant
                            </button>
                        </div>
                        
                        <div class="bg-gradient-to-r from-gray-600 to-gray-800 rounded-2xl p-6 text-white">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <h4 class="text-lg font-bold">üîç Trouve le Verset</h4>
                                    <p class="text-sm opacity-90">Compl√®te les versets manquants</p>
                                </div>
                                <div class="text-3xl pulse-effect">üìú</div>
                            </div>
                            <button onclick="startVerseGame()" class="w-full bg-white bg-opacity-20 text-white font-semibold py-3 rounded-xl hover:bg-opacity-30 transition-all interactive-btn bounce-in">
                                üéÆ Jouer maintenant
                            </button>
                        </div>
                        
                        <div class="bg-gradient-to-r from-gray-500 to-gray-700 rounded-2xl p-6 text-white">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <h4 class="text-lg font-bold">üß© M√©moire Biblique</h4>
                                    <p class="text-sm opacity-90">M√©morise les personnages</p>
                                </div>
                                <div class="text-3xl pulse-effect">üéØ</div>
                            </div>
                            <button onclick="startMemoryGame()" class="w-full bg-white bg-opacity-20 text-white font-semibold py-3 rounded-xl hover:bg-opacity-30 transition-all interactive-btn bounce-in">
                                üéÆ Jouer maintenant
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Jeux Premium -->
                <div class="mb-6">
                    <div class="flex items-center justify-between mb-3">
                        <h4 class="text-md font-semibold text-gray-700 flex items-center">
                            <span class="text-yellow-500 mr-2">üëë</span>
                            Jeux Premium
                        </h4>
                        <button onclick="upgradeToPremium()" class="bg-gradient-to-r from-yellow-400 to-orange-500 text-white px-3 py-1 rounded-full text-xs font-bold premium-glow">
                            D√âBLOQUER
                        </button>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="bg-gradient-to-r from-yellow-400 to-orange-500 rounded-2xl p-6 text-white relative overflow-hidden">
                            <div class="absolute top-2 right-2 bg-green-500 px-2 py-1 rounded-full text-xs font-bold">
                                ‚úÖ D√âBLOQU√â
                            </div>
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <h4 class="text-lg font-bold">‚öîÔ∏è Bataille Biblique</h4>
                                    <p class="text-sm opacity-90">D√©fie tes amis en temps r√©el</p>
                                </div>
                                <div class="text-3xl pulse-effect">‚öîÔ∏è</div>
                            </div>
                            <button onclick="startBattleGame()" class="w-full bg-white bg-opacity-20 text-white font-semibold py-3 rounded-xl hover:bg-opacity-30 transition-all interactive-btn bounce-in">
                                üéÆ Jouer maintenant
                            </button>
                        </div>
                        
                        <div class="bg-gradient-to-r from-purple-500 to-pink-600 rounded-2xl p-6 text-white relative overflow-hidden premium-glow">
                            <div class="absolute top-2 right-2 bg-green-500 px-2 py-1 rounded-full text-xs font-bold">
                                ‚úÖ D√âBLOQU√â
                            </div>
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <h4 class="text-lg font-bold">üèÜ Tournoi des Proph√®tes</h4>
                                    <p class="text-sm opacity-90">Comp√©tition mondiale ‚Ä¢ 2,847 participants</p>
                                </div>
                                <div class="text-3xl pulse-effect">üèÜ</div>
                            </div>
                            <button onclick="startTournament()" class="w-full bg-white bg-opacity-20 text-white font-semibold py-3 rounded-xl hover:bg-opacity-30 transition-all interactive-btn bounce-in">
                                üéÆ Jouer maintenant
                            </button>
                        </div>
                        
                        <div class="bg-gradient-to-r from-indigo-500 to-purple-600 rounded-2xl p-6 text-white relative overflow-hidden premium-glow">
                            <div class="absolute top-2 right-2 bg-green-500 px-2 py-1 rounded-full text-xs font-bold">
                                ‚úÖ D√âBLOQU√â
                            </div>
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <h4 class="text-lg font-bold">üé≠ Myst√®res Bibliques</h4>
                                    <p class="text-sm opacity-90">R√©sous des √©nigmes sacr√©es ‚Ä¢ ‚àû myst√®res infinis ‚Ä¢ Myst√®re ultime : La R√©surrection</p>
                                </div>
                                <div class="text-3xl pulse-effect">üîç</div>
                            </div>
                            <button onclick="startMysteryGame()" class="w-full bg-white bg-opacity-20 text-white font-semibold py-3 rounded-xl hover:bg-opacity-30 transition-all interactive-btn bounce-in">
                                üéÆ Jouer maintenant
                            </button>
                        </div>
                        
                        <div class="bg-gradient-to-r from-emerald-500 to-teal-600 rounded-2xl p-6 text-white relative overflow-hidden premium-glow">
                            <div class="absolute top-2 right-2 bg-green-500 px-2 py-1 rounded-full text-xs font-bold">
                                ‚úÖ D√âBLOQU√â
                            </div>
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <h4 class="text-lg font-bold">üåü Parcours Spirituel</h4>
                                    <p class="text-sm opacity-90">Aventure interactive de 40 jours ‚Ä¢ Jour 1/40 ‚Ä¢ Croissance personnelle</p>
                                </div>
                                <div class="text-3xl pulse-effect">üó∫Ô∏è</div>
                            </div>
                            <button onclick="startSpiritualJourney()" class="w-full bg-white bg-opacity-20 text-white font-semibold py-3 rounded-xl hover:bg-opacity-30 transition-all interactive-btn bounce-in">
                                üéÆ Commencer le parcours
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Avantages Premium -->
                <div class="bg-gradient-to-br from-yellow-50 to-orange-50 border-2 border-yellow-200 rounded-2xl p-4">
                    <div class="text-center mb-4">
                        <div class="text-3xl mb-2">üëë</div>
                        <h4 class="font-bold text-gray-800 mb-1">Passe Premium !</h4>
                        <p class="text-sm text-gray-600">D√©bloquer tous les jeux exclusifs</p>
                    </div>
                    
                    <div class="space-y-2 mb-4">
                        <div class="flex items-center text-sm text-gray-700">
                            <span class="text-green-500 mr-2">‚úÖ</span>
                            <span>4 jeux premium exclusifs</span>
                        </div>
                        <div class="flex items-center text-sm text-gray-700">
                            <span class="text-green-500 mr-2">‚úÖ</span>
                            <span>Mode multijoueur en temps r√©el</span>
                        </div>
                        <div class="flex items-center text-sm text-gray-700">
                            <span class="text-green-500 mr-2">‚úÖ</span>
                            <span>Classements et r√©compenses</span>
                        </div>
                        <div class="flex items-center text-sm text-gray-700">
                            <span class="text-green-500 mr-2">‚úÖ</span>
                            <span>Parcours spirituel personnalis√©</span>
                        </div>
                    </div>
                    
                    <button onclick="upgradeToPremium()" class="w-full bg-gradient-to-r from-yellow-400 to-orange-500 text-white font-bold py-3 rounded-xl premium-glow interactive-btn">
                        üëë Passer Premium - 4,99‚Ç¨/mois
                    </button>
                </div>
            </div>
            
            <!-- Inbox Content -->
            <div id="inboxContent" class="hidden flex-1 flex flex-col">
                <div class="flex items-center justify-between p-4 border-b bg-white">
                    <h3 class="text-lg font-semibold">Messages re√ßus</h3>
                    <div class="flex items-center space-x-2">
                        <button onclick="shareInboxLink()" class="bg-purple-600 text-white px-3 py-2 rounded-full text-sm font-medium interactive-btn hover:glow">
                            üì§ Partager mon lien
                        </button>
                        <button onclick="generateRandomQuestion()" class="bg-gray-100 text-gray-900 px-3 py-1 rounded-full text-sm interactive-btn hover:glow">
                            üé≤ Al√©atoire
                        </button>
                    </div>
                </div>
                
                <div class="flex-1 overflow-y-auto p-4 space-y-4" id="messagesList" style="max-height: calc(100vh - 200px);">
                    <!-- Les messages seront charg√©s ici -->
                </div>
            </div>
        </div>

        <!-- Modal Versets -->
        <div id="versetsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50">
            <div class="bg-white rounded-2xl p-6 max-w-sm w-full max-h-[80vh] overflow-y-auto">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold">üìñ Versets Inspirants</h3>
                    <button onclick="closeVersetsModal()" class="text-2xl text-gray-400 interactive-btn">√ó</button>
                </div>
                
                <div id="versetCard" class="p-6 bg-gradient-to-br from-blue-500 to-indigo-600 text-white rounded-2xl mb-4">
                    <div class="text-center">
                        <div class="text-4xl mb-3">üìñ</div>
                        <div class="bg-white bg-opacity-20 rounded-lg p-4 mb-4">
                            <p id="versetText" class="text-sm font-medium italic mb-2">"Car Dieu a tant aim√© le monde qu'il a donn√© son Fils unique, afin que quiconque croit en lui ne p√©risse point, mais qu'il ait la vie √©ternelle."</p>
                            <p id="versetRef" class="text-xs opacity-75">Jean 3:16</p>
                        </div>
                        <p class="text-sm opacity-75">Verset <span id="currentVersetNumber">1</span>/‚àû</p>
                    </div>
                </div>
                
                <div class="flex items-center justify-center space-x-4 mb-4">
                    <button onclick="previousVerset()" class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center text-gray-600 interactive-btn">
                        ‚Üê
                    </button>
                    <button onclick="randomVerset()" class="bg-gray-100 text-gray-900 px-4 py-2 rounded-full text-sm font-medium interactive-btn">
                        üé≤ Al√©atoire
                    </button>
                    <button onclick="nextVerset()" class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center text-gray-600 interactive-btn">
                        ‚Üí
                    </button>
                </div>
                
                <div class="space-y-3">
                    <button onclick="shareCurrentVerset()" class="w-full bg-blue-600 text-white font-bold py-3 rounded-xl interactive-btn">
                        üì± Partager ce verset
                    </button>
                    <button onclick="editCurrentVerset()" class="w-full bg-yellow-500 text-white font-bold py-3 rounded-xl interactive-btn">
                        ‚úèÔ∏è Modifier ce verset
                    </button>
                    <button onclick="sendVersetToSomeone()" class="w-full bg-green-600 text-white font-bold py-3 rounded-xl interactive-btn">
                        üíå Envoyer √† quelqu'un
                    </button>
                    <button onclick="copyCurrentVerset()" class="w-full bg-gray-100 text-gray-700 font-medium py-3 rounded-xl interactive-btn">
                        üìã Copier le verset
                    </button>
                    <button onclick="showVersetInsights()" class="w-full bg-green-100 text-green-700 font-medium py-3 rounded-xl interactive-btn">
                        üìä Voir les indices
                    </button>
                </div>
            </div>
        </div>

    </div>

    <script>
        let currentPage = 'welcomePage';
        let selectedPlatform = '';
        let username = '';
        let profileEmoji = 'üôè';
        let currentQuestionIndex = 0;
        let currentVersetIndex = 0;
        let currentConversation = null;
        let currentFilter = 'all';
        let isConfigured = false;

        // Configuration Google Apps Script
        let GOOGLE_SCRIPT_URL = '';
        let GOOGLE_SHEET_ID = '';

        // Base de donn√©es de versets par cat√©gories
        const versetCategories = {
            amour: [
                { text: "Car Dieu a tant aim√© le monde qu'il a donn√© son Fils unique, afin que quiconque croit en lui ne p√©risse point, mais qu'il ait la vie √©ternelle.", ref: "Jean 3:16" },
                { text: "Nous l'aimons, parce qu'il nous a aim√©s le premier.", ref: "1 Jean 4:19" },
                { text: "L'amour est patient, l'amour est plein de bont√©; l'amour n'est point envieux.", ref: "1 Corinthiens 13:4" },
                { text: "Comme le P√®re m'a aim√©, je vous ai aussi aim√©s. Demeurez dans mon amour.", ref: "Jean 15:9" },
                { text: "Il n'y a pas de plus grand amour que de donner sa vie pour ses amis.", ref: "Jean 15:13" }
            ],
            force: [
                { text: "Je puis tout par celui qui me fortifie.", ref: "Philippiens 4:13" },
                { text: "Mais ceux qui se confient en l'√âternel renouvellent leur force.", ref: "√âsa√Øe 40:31" },
                { text: "Au reste, fortifiez-vous dans le Seigneur, et par sa force toute-puissante.", ref: "√âph√©siens 6:10" },
                { text: "L'√âternel est ma force et mon bouclier; En lui mon c≈ìur se confie.", ref: "Psaume 28:7" },
                { text: "Quand je suis faible, c'est alors que je suis fort.", ref: "2 Corinthiens 12:10" }
            ],
            paix: [
                { text: "Venez √† moi, vous tous qui √™tes fatigu√©s et charg√©s, et je vous donnerai du repos.", ref: "Matthieu 11:28" },
                { text: "Ne vous inqui√©tez de rien; mais en toute chose faites conna√Ætre vos besoins √† Dieu.", ref: "Philippiens 4:6" },
                { text: "Et la paix de Dieu, qui surpasse toute intelligence, gardera vos c≈ìurs.", ref: "Philippiens 4:7" },
                { text: "Je vous laisse la paix, je vous donne ma paix.", ref: "Jean 14:27" },
                { text: "L'√âternel est mon berger: je ne manquerai de rien.", ref: "Psaume 23:1" }
            ]
        };

        // Fonction pour g√©n√©rer un verset al√©atoire infini
        function generateInfiniteVerset() {
            const categories = Object.keys(versetCategories);
            const randomCategory = categories[Math.floor(Math.random() * categories.length)];
            const categoryVersets = versetCategories[randomCategory];
            const randomVerset = categoryVersets[Math.floor(Math.random() * categoryVersets.length)];
            
            return {
                text: randomVerset.text,
                ref: randomVerset.ref,
                category: randomCategory
            };
        }

        // Versets actuels (g√©n√©r√©s dynamiquement)
        let allVersets = [];
        let totalVersetsGenerated = 0;

        // Initialiser avec 100 versets
        function initializeVersets() {
            allVersets = [];
            for (let i = 0; i < 100; i++) {
                allVersets.push(generateInfiniteVerset());
                totalVersetsGenerated++;
            }
        }

        // ===== SETUP PANEL FUNCTIONS =====

        function openSetupPanel() {
            document.getElementById('setupPanel').style.display = 'block';
            checkConfiguration();
        }

        function closeSetupPanel() {
            document.getElementById('setupPanel').style.display = 'none';
        }

        function checkConfiguration() {
            const savedConfig = localStorage.getItem('praylink_config');
            if (savedConfig) {
                const config = JSON.parse(savedConfig);
                GOOGLE_SCRIPT_URL = config.scriptUrl;
                GOOGLE_SHEET_ID = config.sheetId;
                
                document.getElementById('scriptUrl').value = GOOGLE_SCRIPT_URL;
                document.getElementById('sheetsUrl').value = `https://docs.google.com/spreadsheets/d/${GOOGLE_SHEET_ID}/edit`;
                
                if (GOOGLE_SCRIPT_URL && GOOGLE_SHEET_ID) {
                    isConfigured = true;
                    updateSetupStatus();
                }
            }
        }

        function validateSheetsUrl() {
            const url = document.getElementById('sheetsUrl').value;
            const match = url.match(/\/spreadsheets\/d\/([a-zA-Z0-9-_]+)/);
            
            if (match) {
                GOOGLE_SHEET_ID = match[1];
                document.getElementById('sheetsStatus').className = 'status-indicator status-online';
                showNotification('‚úÖ Google Sheets valid√© !');
                saveConfiguration();
            } else {
                showNotification('‚ùå URL Google Sheets invalide');
            }
        }

        function validateScriptUrl() {
            const url = document.getElementById('scriptUrl').value;
            
            if (url.includes('script.google.com') && url.includes('/exec')) {
                GOOGLE_SCRIPT_URL = url;
                document.getElementById('scriptStatus').className = 'status-indicator status-online';
                showNotification('‚úÖ Google Apps Script valid√© !');
                saveConfiguration();
            } else {
                showNotification('‚ùå URL Google Apps Script invalide');
            }
        }

        function saveConfiguration() {
            if (GOOGLE_SCRIPT_URL && GOOGLE_SHEET_ID) {
                const config = {
                    scriptUrl: GOOGLE_SCRIPT_URL,
                    sheetId: GOOGLE_SHEET_ID,
                    configured: true
                };
                localStorage.setItem('praylink_config', JSON.stringify(config));
                isConfigured = true;
            }
        }

        function updateSetupStatus() {
            if (GOOGLE_SHEET_ID) {
                document.getElementById('sheetsStatus').className = 'status-indicator status-online';
            }
            if (GOOGLE_SCRIPT_URL) {
                document.getElementById('scriptStatus').className = 'status-indicator status-online';
            }
            if (isConfigured) {
                document.getElementById('connectionStatus').className = 'status-indicator status-online';
            }
        }

        async function testConnection() {
            if (!GOOGLE_SCRIPT_URL) {
                showNotification('‚ùå Configurez d\'abord Google Apps Script');
                return;
            }
            
            showNotification('üîç Test de connexion...');
            
            try {
                const response = await fetch(GOOGLE_SCRIPT_URL);
                const result = await response.json();
                
                if (result.status) {
                    document.getElementById('connectionStatus').className = 'status-indicator status-online';
                    showNotification('‚úÖ Connexion r√©ussie !');
                } else {
                    throw new Error('R√©ponse invalide');
                }
            } catch (error) {
                document.getElementById('connectionStatus').className = 'status-indicator status-offline';
                showNotification('‚ùå √âchec de la connexion');
            }
        }

        async function initializeDatabase() {
            if (!isConfigured) {
                showNotification('‚ùå Configurez d\'abord le serveur');
                return;
            }
            
            showNotification('üöÄ Initialisation de la base de donn√©es...');
            
            try {
                // Initialiser avec quelques versets
                const defaultVerses = [
                    {
                        text: "Car Dieu a tant aim√© le monde qu'il a donn√© son Fils unique, afin que quiconque croit en lui ne p√©risse point, mais qu'il ait la vie √©ternelle.",
                        ref: "Jean 3:16",
                        category: "amour"
                    },
                    {
                        text: "Je puis tout par celui qui me fortifie.",
                        ref: "Philippiens 4:13",
                        category: "force"
                    },
                    {
                        text: "Venez √† moi, vous tous qui √™tes fatigu√©s et charg√©s, et je vous donnerai du repos.",
                        ref: "Matthieu 11:28",
                        category: "paix"
                    }
                ];
                
                for (const verse of defaultVerses) {
                    await apiCall('verses/add', 'POST', verse);
                }
                
                showNotification('‚úÖ Base de donn√©es initialis√©e !');
            } catch (error) {
                showNotification('‚ùå Erreur d\'initialisation');
            }
        }

        function finishSetup() {
            if (!isConfigured) {
                showNotification('‚ùå Configuration incompl√®te');
                return;
            }
            
            closeSetupPanel();
            showNotification('üéâ Configuration termin√©e ! PrayLink est pr√™t.');
            
            // Charger les vraies donn√©es
            loadRealMessages();
            loadRealVerses();
        }

        // ===== API FUNCTIONS =====

        async function apiCall(endpoint, method = 'GET', data = null) {
            if (!GOOGLE_SCRIPT_URL) {
                showNotification('‚ö†Ô∏è Mode hors ligne - Configurez le serveur');
                return getOfflineData(endpoint);
            }
            
            try {
                const requestData = {
                    action: endpoint,
                    method: method,
                    data: data
                };
                
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData)
                });
                
                const result = await response.json();
                return result;
            } catch (error) {
                console.error('API Error:', error);
                showNotification('‚ùå Erreur de connexion au serveur');
                
                // Mode hors ligne avec donn√©es simul√©es
                return getOfflineData(endpoint);
            }
        }

        // Donn√©es hors ligne de secours
        function getOfflineData(endpoint) {
            const currentUser = username || 'prayerwarrior';
            
            const offlineData = {
                [`messages/${currentUser}`]: [
                    {
                        _id: 'offline1',
                        type: 'question',
                        content: 'Quel est ton verset pr√©f√©r√© pour les moments difficiles ?',
                        sender: 'Anonyme',
                        createdAt: new Date().toISOString()
                    },
                    {
                        _id: 'offline2',
                        type: 'prayer',
                        content: 'Peux-tu prier pour ma famille ? Nous traversons une p√©riode difficile.',
                        sender: 'Anonyme',
                        createdAt: new Date().toISOString()
                    },
                    {
                        _id: 'offline3',
                        type: 'testimony',
                        content: 'Ton dernier post m\'a vraiment encourag√©. Merci pour ton t√©moignage !',
                        sender: 'Anonyme',
                        createdAt: new Date().toISOString()
                    }
                ],
                'verses': allVersets.slice(0, 10),
                'admin/stats': {
                    users: 1247,
                    messages: 8932,
                    games: 156,
                    uptime: '99.8'
                }
            };
            
            return offlineData[endpoint] || null;
        }

        // Charger les vrais messages
        async function loadRealMessages() {
            const currentUser = username || 'prayerwarrior';
            const messages = await apiCall(`messages/${currentUser}`);
            
            if (messages) {
                displayMessages(messages);
                updateMessageCount(messages.length);
            }
        }

        // Afficher les messages r√©els
        function displayMessages(messages) {
            const messagesList = document.getElementById('messagesList');
            if (!messagesList) return;
            
            if (messages.length === 0) {
                messagesList.innerHTML = `
                    <div class="text-center py-8">
                        <div class="text-6xl mb-4">üì≠</div>
                        <h3 class="text-lg font-semibold text-gray-700 mb-2">Aucun message pour le moment</h3>
                        <p class="text-gray-500 text-sm mb-4">Partage ton lien pour recevoir des messages anonymes !</p>
                        <button onclick="shareInboxLink()" class="bg-purple-600 text-white px-4 py-2 rounded-full text-sm font-medium">
                            üì§ Partager mon lien
                        </button>
                    </div>
                `;
                return;
            }
            
            messagesList.innerHTML = messages.map(msg => {
                const typeColors = {
                    question: 'from-purple-500 to-pink-600',
                    prayer: 'from-green-500 to-emerald-600',
                    testimony: 'from-orange-500 to-red-600',
                    verse: 'from-blue-500 to-indigo-600'
                };
                
                const typeIcons = {
                    question: '‚ùì',
                    prayer: 'üôè',
                    testimony: '‚ú®',
                    verse: 'üìñ'
                };
                
                return `
                    <div class="bg-gradient-to-r ${typeColors[msg.type]} rounded-2xl p-4 text-white">
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex items-center">
                                <div class="w-8 h-8 bg-white bg-opacity-30 rounded-full flex items-center justify-center text-sm mr-3">
                                    ${typeIcons[msg.type]}
                                </div>
                                <div>
                                    <div class="text-xs opacity-75">${msg.type} ‚Ä¢ ${new Date(msg.createdAt).toLocaleString()}</div>
                                    <div class="text-xs opacity-75">${msg.sender}</div>
                                </div>
                            </div>
                        </div>
                        <p class="text-sm mb-3">"${msg.content}"</p>
                        <div class="flex space-x-2">
                            <button onclick="replyToMessage('${msg._id}')" class="bg-white bg-opacity-20 text-white px-3 py-1 rounded-full text-xs font-medium">
                                üí¨ R√©pondre
                            </button>
                            <button onclick="shareMessage('${msg._id}')" class="bg-white bg-opacity-20 text-white px-3 py-1 rounded-full text-xs font-medium">
                                üì§ Partager
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Envoyer un vrai message
        async function sendMessage(type, content, recipient) {
            const messageData = {
                recipient: recipient || username || 'prayerwarrior',
                type,
                content,
                sender: 'Anonyme'
            };
            
            const result = await apiCall('messages/send', 'POST', messageData);
            
            if (result && result.success) {
                showNotification('‚úÖ Message envoy√© !');
                loadRealMessages(); // Recharger les messages
                updateUserStats(type);
            }
        }

        // Charger les vrais versets depuis l'API
        async function loadRealVerses() {
            const verses = await apiCall('verses');
            if (verses && verses.length > 0) {
                allVersets = verses.map(v => ({
                    text: v.text,
                    ref: v.ref,
                    category: v.category
                }));
                updateVersetDisplay();
            }
        }

        // Sauvegarder l'utilisateur
        async function saveUser() {
            const userData = {
                username: username || 'prayerwarrior',
                platform: selectedPlatform || 'instagram',
                profileEmoji: profileEmoji || 'üôè'
            };
            
            const result = await apiCall('auth/register', 'POST', userData);
            
            if (result && result.success) {
                showNotification('‚úÖ Profil sauvegard√© !');
                localStorage.setItem('praylink_user', JSON.stringify(userData));
            }
        }

        // Mettre √† jour le compteur de messages
        function updateMessageCount(count) {
            const messageCountEl = document.getElementById('messageCount');
            if (messageCountEl) {
                messageCountEl.textContent = count;
                messageCountEl.style.display = count > 0 ? 'flex' : 'none';
            }
        }

        // Mettre √† jour les statistiques utilisateur
        function updateUserStats(type) {
            const statsMap = {
                question: 'questionsShared',
                verse: 'versesShared',
                prayer: 'userPrayersCount',
                testimony: 'userTestimoniesCount'
            };
            
            const elementId = statsMap[type];
            if (elementId) {
                const element = document.getElementById(elementId);
                if (element) {
                    const currentValue = parseInt(element.textContent) || 0;
                    element.textContent = currentValue + 1;
                }
            }
            
            // Mettre √† jour le compteur de r√©ponses re√ßues
            const responsesEl = document.getElementById('responsesReceived');
            if (responsesEl) {
                const currentValue = parseInt(responsesEl.textContent) || 0;
                responsesEl.textContent = currentValue + 1;
            }
        }

        // ===== EXISTING FUNCTIONS =====

        function goToPage(pageId) {
            // Sauvegarder le nom d'utilisateur si on quitte la page username
            if (currentPage === 'usernamePage') {
                const usernameInput = document.getElementById('usernameInput');
                if (usernameInput && usernameInput.value) {
                    username = usernameInput.value.replace('@', '');
                    document.getElementById('mainUsername').textContent = '@' + username;
                }
            }
            
            // Sauvegarder l'utilisateur si on arrive √† la page principale
            if (pageId === 'mainPage') {
                saveUser();
            }
            
            // Cacher toutes les pages
            const pages = ['welcomePage', 'platformPage', 'usernamePage', 'profilePhotoPage', 'premiumPage', 'mainPage', 'settingsPage', 'inboxPage'];
            pages.forEach(page => {
                const element = document.getElementById(page);
                if (element) {
                    element.classList.add('hidden');
                }
            });
            
            // Afficher la page demand√©e
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.remove('hidden');
                targetPage.classList.add('slide-in');
            }
            
            currentPage = pageId;
            
            // Charger les vraies donn√©es si on va √† l'inbox
            if (pageId === 'mainPage') {
                loadRealMessages();
                loadRealVerses();
            }
            
            showNotification(`üì± Navigation vers ${pageId}`);
        }

        function selectPlatform(platform) {
            selectedPlatform = platform;
            showNotification(`${platform} s√©lectionn√© !`);
        }

        function setProfileEmoji(emoji) {
            profileEmoji = emoji;
            
            const profileDisplay = document.getElementById('profileEmoji');
            const mainProfile = document.getElementById('mainProfileEmoji');
            
            if (profileDisplay) {
                profileDisplay.textContent = emoji;
            }
            
            if (mainProfile) {
                mainProfile.textContent = emoji;
            }
            
            showNotification(`${emoji} Emoji s√©lectionn√© !`);
        }

        function selectProfilePhoto() {
            showNotification('üì∑ Fonctionnalit√© de photo √† venir !');
        }

        function showTab(tab) {
            // Reset all tabs
            document.getElementById('playTab').classList.remove('border-purple-600', 'text-purple-600');
            document.getElementById('playTab').classList.add('text-gray-500');
            document.getElementById('gamesTab').classList.remove('border-purple-600', 'text-purple-600');
            document.getElementById('gamesTab').classList.add('text-gray-500');
            document.getElementById('inboxTab').classList.remove('border-purple-600', 'text-purple-600');
            document.getElementById('inboxTab').classList.add('text-gray-500');
            
            // Hide all content
            document.getElementById('playContent').classList.add('hidden');
            document.getElementById('gamesContent').classList.add('hidden');
            document.getElementById('inboxContent').classList.add('hidden');
            
            // Show selected tab and content
            if (tab === 'play') {
                document.getElementById('playTab').classList.add('border-purple-600', 'text-purple-600');
                document.getElementById('playTab').classList.remove('text-gray-500');
                document.getElementById('playContent').classList.remove('hidden');
            } else if (tab === 'games') {
                document.getElementById('gamesTab').classList.add('border-purple-600', 'text-purple-600');
                document.getElementById('gamesTab').classList.remove('text-gray-500');
                document.getElementById('gamesContent').classList.remove('hidden');
            } else {
                document.getElementById('inboxTab').classList.add('border-purple-600', 'text-purple-600');
                document.getElementById('inboxTab').classList.remove('text-gray-500');
                document.getElementById('inboxContent').classList.remove('hidden');
            }
        }

        // Versets Modal Functions
        function openVersetsModal() {
            document.getElementById('versetsModal').classList.remove('hidden');
            document.getElementById('versetsModal').classList.add('flex');
            updateVersetDisplay();
        }

        function closeVersetsModal() {
            document.getElementById('versetsModal').classList.add('hidden');
            document.getElementById('versetsModal').classList.remove('flex');
        }

        function updateVersetDisplay() {
            // G√©n√©rer plus de versets si n√©cessaire
            if (currentVersetIndex >= allVersets.length - 10) {
                for (let i = 0; i < 50; i++) {
                    allVersets.push(generateInfiniteVerset());
                    totalVersetsGenerated++;
                }
            }
            
            const currentVerset = allVersets[currentVersetIndex];
            const versetText = document.getElementById('versetText');
            const versetRef = document.getElementById('versetRef');
            const versetNumber = document.getElementById('currentVersetNumber');
            
            if (versetText) {
                versetText.textContent = `"${currentVerset.text}"`;
            }
            if (versetRef) {
                versetRef.textContent = currentVerset.ref;
            }
            if (versetNumber) {
                versetNumber.textContent = currentVersetIndex + 1;
            }
        }

        function nextVerset() {
            currentVersetIndex++;
            updateVersetDisplay();
            showNotification('‚û°Ô∏è Verset suivant');
        }

        function previousVerset() {
            if (currentVersetIndex > 0) {
                currentVersetIndex--;
                updateVersetDisplay();
                showNotification('‚¨ÖÔ∏è Verset pr√©c√©dent');
            }
        }

        function randomVerset() {
            // G√©n√©rer un nouveau verset al√©atoire
            const newVerset = generateInfiniteVerset();
            allVersets.push(newVerset);
            currentVersetIndex = allVersets.length - 1;
            totalVersetsGenerated++;
            updateVersetDisplay();
            showNotification('üé≤ Nouveau verset g√©n√©r√© !');
        }

        function copyCurrentVerset() {
            const currentVerset = allVersets[currentVersetIndex];
            const versetText = `"${currentVerset.text}" - ${currentVerset.ref}`;
            showNotification('üìã Verset copi√© !');
        }

        function shareCurrentVerset() {
            const currentVerset = allVersets[currentVersetIndex];
            const shareLink = `https://praylink.app/v/${currentVersetIndex}?u=${encodeURIComponent(username || 'PrayerWarrior')}`;
            
            // Cr√©er le contenu de partage
            const shareText = `"${currentVerset.text}"\n${currentVerset.ref}\n\nPartag√© par ${username || '@PrayerWarrior'} sur PrayLink üôè\n${shareLink}`;
            
            showNotification('üì± Verset partag√© !');
        }

        function editCurrentVerset() {
            showNotification('‚úèÔ∏è Fonctionnalit√© d\'√©dition √† venir !');
        }

        function sendVersetToSomeone() {
            showNotification('üíå Fonctionnalit√© d\'envoi √† venir !');
        }

        function showVersetInsights() {
            showNotification('üìä Indices d\'activit√© √† venir !');
        }

        // Notification system
        function showNotification(message) {
            // Cr√©er l'√©l√©ment de notification
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            
            // Ajouter au DOM
            document.body.appendChild(notification);
            
            // Afficher avec animation
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            // Masquer apr√®s 3 secondes
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // Modals pour envoyer des messages r√©els
        function openQuestionsModal() {
            const question = prompt('‚ùì Quelle question biblique veux-tu poser ?');
            if (question) {
                sendMessage('question', question);
            }
        }

        function openPrayersModal() {
            const prayer = prompt('üôè Quelle demande de pri√®re veux-tu partager ?');
            if (prayer) {
                sendMessage('prayer', prayer);
            }
        }

        function openTestimoniesModal() {
            const testimony = prompt('‚ú® Quel t√©moignage veux-tu partager ?');
            if (testimony) {
                sendMessage('testimony', testimony);
            }
        }

        // Fonctions de jeux
        function startBibleQuiz() {
            showNotification('üß† Quiz biblique lanc√© !');
        }

        function startVerseGame() {
            showNotification('üìú Jeu de versets lanc√© !');
        }

        function startMemoryGame() {
            showNotification('üéØ Jeu de m√©moire lanc√© !');
        }

        function startBattleGame() {
            showNotification('‚öîÔ∏è Bataille biblique lanc√©e !');
        }

        function startTournament() {
            showNotification('üèÜ Tournoi des Proph√®tes lanc√© !');
        }

        function startMysteryGame() {
            showNotification('üîç Myst√®res bibliques lanc√©s !');
        }

        function startSpiritualJourney() {
            showNotification('üåü Parcours spirituel commenc√© !');
        }

        function upgradeToPremium() {
            showNotification('üëë Mise √† niveau Premium !');
        }

        // Fonctions inbox
        function shareInboxLink() {
            const link = `https://praylink.app/u/${username || 'prayerwarrior'}`;
            showNotification('üì§ Lien de partage copi√© !');
        }

        function generateRandomQuestion() {
            const questions = [
                "Quel est ton verset pr√©f√©r√© et pourquoi ?",
                "Comment Dieu t'a-t-il parl√© r√©cemment ?",
                "Quelle pri√®re aimerais-tu partager ?",
                "Quel t√©moignage t'a le plus marqu√© ?",
                "Comment vis-tu ta foi au quotidien ?"
            ];
            const randomQ = questions[Math.floor(Math.random() * questions.length)];
            showNotification(`üé≤ Question: ${randomQ}`);
        }

        function replyToMessage(messageId) {
            showNotification(`üí¨ R√©ponse au message ${messageId} !`);
        }

        function shareMessage(messageId) {
            showNotification(`üì§ Message ${messageId} partag√© !`);
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            // Charger l'utilisateur sauvegard√©
            const savedUser = localStorage.getItem('praylink_user');
            if (savedUser) {
                const userData = JSON.parse(savedUser);
                username = userData.username;
                selectedPlatform = userData.platform;
                profileEmoji = userData.profileEmoji;
                
                // Mettre √† jour l'interface
                if (username) {
                    document.getElementById('mainUsername').textContent = '@' + username;
                    document.getElementById('mainProfileEmoji').textContent = profileEmoji;
                }
            }
            
            initializeVersets();
            checkConfiguration();
            
            // Charger les vraies donn√©es au d√©marrage
            loadRealMessages();
            loadRealVerses();
            
            // Afficher le bouton de configuration si pas configur√©
            if (!isConfigured) {
                document.getElementById('setupBtn').style.display = 'block';
            }
            
            showNotification('üôè PrayLink charg√© avec succ√®s !');
        });

        // √âcouter Ctrl+Shift+S pour ouvrir la configuration
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.shiftKey && e.key === 'S') {
                e.preventDefault();
                openSetupPanel();
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97e62fbd71e751c5',t:'MTc1Nzc1MTIxOS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
