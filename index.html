<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PrayLink - Messages Anonymes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        body { font-family: 'Inter', sans-serif; }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .app-container {
            max-width: 375px;
            margin: 0 auto;
            min-height: 100vh;
            background: white;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        
        @media (max-width: 768px) {
            .app-container {
                max-width: 100%;
                box-shadow: none;
            }
        }
        
        .interactive-btn {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .interactive-btn:hover {
            transform: translateY(-2px);
            opacity: 0.9;
        }
        
        .pulse-effect {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .response-page {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #2d2d2d;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            z-index: 10000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .admin-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.95);
            z-index: 9999;
            display: none;
            overflow-y: auto;
        }
        
        .admin-content {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            min-height: 100vh;
            color: white;
        }
        
        .admin-section {
            background: #2d2d2d;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #444;
        }
        
        .admin-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s ease;
        }
        
        .admin-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .admin-input {
            background: #3d3d3d;
            border: 1px solid #555;
            color: white;
            padding: 10px;
            border-radius: 6px;
            width: 100%;
            margin: 5px 0;
        }
        
        .game-modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 16px;
            z-index: 50;
        }
        
        .memory-card {
            transition: all 0.3s ease;
        }
        
        .memory-card.flipped {
            background: #10b981 !important;
        }
        
        .context-selector {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border-radius: 20px;
            padding: 20px;
            color: white;
            margin: 20px 0;
        }
    </style>
</head>
<body class="bg-gray-50">

    <!-- Page de rÃ©ponse anonyme -->
    <div id="responsePage" class="response-page hidden">
        <div class="container mx-auto px-4 py-8 max-w-md">
            <div class="text-center mb-8">
                <div class="w-20 h-20 bg-white bg-opacity-20 rounded-full mx-auto mb-4 flex items-center justify-center text-3xl">
                    ğŸ’¬
                </div>
                <h1 class="text-2xl font-bold mb-2">RÃ©pondre anonymement</h1>
                <p class="opacity-90">Ã  <span id="responseRecipient">@utilisateur</span></p>
            </div>

            <div class="bg-white bg-opacity-10 rounded-2xl p-6 mb-6">
                <div class="text-sm opacity-75 mb-2">Contexte : <span id="responseContext">Question</span></div>
                <p id="originalMessage" class="italic">"Quel est ton verset prÃ©fÃ©rÃ© ?"</p>
            </div>

            <div class="space-y-4 mb-6">
                <textarea id="responseText" placeholder="Ã‰cris ta rÃ©ponse anonyme..." 
                         class="w-full p-4 rounded-xl bg-white bg-opacity-10 border border-white border-opacity-20 text-white placeholder-white placeholder-opacity-60 resize-none" 
                         rows="4"></textarea>
            </div>

            <div class="space-y-3 mb-8">
                <button onclick="sendAnonymousResponse()" class="w-full bg-white text-purple-600 font-bold py-4 rounded-xl interactive-btn">
                    ğŸ“¤ Envoyer ma rÃ©ponse
                </button>
                <button onclick="addEmoji()" class="w-full bg-white bg-opacity-20 text-white font-medium py-3 rounded-xl interactive-btn">
                    ğŸ˜Š Ajouter un emoji
                </button>
            </div>

            <div class="text-center">
                <p class="text-sm opacity-75 mb-4">Tu veux aussi recevoir des messages anonymes ?</p>
                <button onclick="createMyPrayLink()" class="bg-yellow-400 text-gray-900 font-bold px-6 py-3 rounded-full interactive-btn">
                    ğŸ™ CrÃ©er mon PrayLink
                </button>
            </div>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="adminPanel" class="admin-panel">
        <div class="admin-content">
            <div class="flex justify-between items-center mb-8">
                <h1 class="text-3xl font-bold">âš™ï¸ Administration PrayLink</h1>
                <button onclick="closeAdminPanel()" class="admin-btn" style="background: #e74c3c;">
                    âœ• Fermer
                </button>
            </div>

            <!-- Configuration -->
            <div class="admin-section">
                <h2 class="text-xl font-bold mb-4">ğŸ”§ Configuration</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Nom de l'app :</label>
                        <input type="text" id="appName" class="admin-input" value="PrayLink" placeholder="Nom de l'application">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">URL de base :</label>
                        <input type="text" id="baseUrl" class="admin-input" value="https://praylink.app" placeholder="URL de base">
                    </div>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Google Apps Script URL :</label>
                    <input type="text" id="scriptUrl" class="admin-input" placeholder="https://script.google.com/macros/s/YOUR_ID/exec">
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Google Sheet ID :</label>
                    <input type="text" id="sheetId" class="admin-input" placeholder="1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms">
                </div>
                
                <button onclick="saveConfig()" class="admin-btn">ğŸ’¾ Sauvegarder la configuration</button>
            </div>

            <!-- Statistiques -->
            <div class="admin-section">
                <h2 class="text-xl font-bold mb-4">ğŸ“Š Statistiques</h2>
                
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                    <div class="bg-blue-600 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold" id="totalUsers">127</div>
                        <div class="text-sm opacity-90">Utilisateurs</div>
                    </div>
                    <div class="bg-green-600 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold" id="totalMessages">1,543</div>
                        <div class="text-sm opacity-90">Messages</div>
                    </div>
                    <div class="bg-purple-600 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold" id="totalGames">892</div>
                        <div class="text-sm opacity-90">Parties jouÃ©es</div>
                    </div>
                    <div class="bg-orange-600 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold" id="totalShares">2,341</div>
                        <div class="text-sm opacity-90">Partages</div>
                    </div>
                </div>
                
                <button onclick="refreshStats()" class="admin-btn">ğŸ”„ Actualiser</button>
                <button onclick="exportData()" class="admin-btn" style="background: #2ecc71;">ğŸ“¥ Exporter les donnÃ©es</button>
            </div>

            <!-- Gestion des contenus avec onglets -->
            <div class="admin-section">
                <h2 class="text-xl font-bold mb-4">ğŸ“ Gestion des contenus</h2>
                
                <!-- Onglets de contenu -->
                <div class="flex border-b mb-4">
                    <button onclick="showContentTab('questions')" class="px-4 py-2 border-b-2 border-blue-500 text-blue-600 font-medium" id="questionsTab">
                        â“ Questions
                    </button>
                    <button onclick="showContentTab('verses')" class="px-4 py-2 text-gray-500 font-medium" id="versesTab">
                        ğŸ“– Versets
                    </button>
                    <button onclick="showContentTab('prayers')" class="px-4 py-2 text-gray-500 font-medium" id="prayersTab">
                        ğŸ™ PriÃ¨res
                    </button>
                    <button onclick="showContentTab('testimonies')" class="px-4 py-2 text-gray-500 font-medium" id="testimoniesTab">
                        âœ¨ TÃ©moignages
                    </button>
                    <button onclick="showContentTab('characters')" class="px-4 py-2 text-gray-500 font-medium" id="charactersTab">
                        ğŸ‘¤ Personnages
                    </button>
                </div>
                
                <!-- Contenu Questions -->
                <div id="questionsContent" class="content-tab">
                    <div class="mb-4">
                        <h4 class="font-semibold mb-2">Questions pour le quiz :</h4>
                        <textarea id="quizQuestions" class="admin-input" rows="6" placeholder="Format: Question | Option1,Option2,Option3,Option4 | IndexCorrect">Qui a construit l'arche ? | MoÃ¯se,NoÃ©,Abraham,David | 1
Combien d'apÃ´tres JÃ©sus avait-il ? | 10,11,12,13 | 2</textarea>
                    </div>
                    <div>
                        <h4 class="font-semibold mb-2">Questions prÃ©dÃ©finies :</h4>
                        <textarea id="predefinedQuestions" class="admin-input" rows="4" placeholder="Une question par ligne">Quel est ton verset prÃ©fÃ©rÃ© ?
Comment Dieu t'a-t-il bÃ©ni rÃ©cemment ?
Pour quoi aimerais-tu qu'on prie ?
Quel tÃ©moignage veux-tu partager ?</textarea>
                    </div>
                </div>
                
                <!-- Contenu Versets -->
                <div id="versesContent" class="content-tab hidden">
                    <div class="mb-4">
                        <h4 class="font-semibold mb-2">Versets pour le jeu (avec mots manquants) :</h4>
                        <textarea id="verseGameData" class="admin-input" rows="6" placeholder="Format: Verset incomplet | Mot manquant | RÃ©fÃ©rence">Car Dieu a tant aimÃ© le monde qu'il a donnÃ© son Fils _____ | unique | Jean 3:16
Je puis tout par celui qui me _____ | fortifie | Philippiens 4:13</textarea>
                    </div>
                    <div>
                        <h4 class="font-semibold mb-2">Versets complets :</h4>
                        <textarea id="bibleVerses" class="admin-input" rows="4" placeholder="Format: Verset | RÃ©fÃ©rence">Car Dieu a tant aimÃ© le monde qu'il a donnÃ© son Fils unique | Jean 3:16
Je puis tout par celui qui me fortifie | Philippiens 4:13</textarea>
                    </div>
                </div>
                
                <!-- Contenu PriÃ¨res -->
                <div id="prayersContent" class="content-tab hidden">
                    <div>
                        <h4 class="font-semibold mb-2">PriÃ¨res :</h4>
                        <textarea id="prayersData" class="admin-input" rows="8" placeholder="Format: Titre | Texte de la priÃ¨re">PriÃ¨re du matin | Seigneur, merci pour cette nouvelle journÃ©e. Guide mes pas et que ta volontÃ© soit faite. Amen.
PriÃ¨re de protection | PÃ¨re cÃ©leste, protÃ¨ge ma famille et mes proches. Couvre-nous de ton amour et de ta paix. Amen.</textarea>
                    </div>
                </div>
                
                <!-- Contenu TÃ©moignages -->
                <div id="testimoniesContent" class="content-tab hidden">
                    <div>
                        <h4 class="font-semibold mb-2">TÃ©moignages :</h4>
                        <textarea id="testimoniesData" class="admin-input" rows="8" placeholder="Format: Titre | Texte du tÃ©moignage">GuÃ©rison miraculeuse | Dieu m'a guÃ©ri d'une maladie que les mÃ©decins ne pouvaient pas soigner. Sa grÃ¢ce est infinie ! ğŸ™
Provision divine | Quand j'Ã©tais dans le besoin, Dieu a pourvu de maniÃ¨re inattendue. Il est fidÃ¨le ! âœ¨</textarea>
                    </div>
                </div>
                
                <!-- Contenu Personnages -->
                <div id="charactersContent" class="content-tab hidden">
                    <div>
                        <h4 class="font-semibold mb-2">Personnages bibliques :</h4>
                        <textarea id="charactersData" class="admin-input" rows="8" placeholder="Format: Nom | Indice1,Indice2,Indice3">MoÃ¯se | J'ai libÃ©rÃ© le peuple d'IsraÃ«l,J'ai reÃ§u les 10 commandements,J'ai sÃ©parÃ© la mer Rouge
David | J'Ã©tais berger,J'ai vaincu Goliath,J'ai Ã©crit des psaumes</textarea>
                    </div>
                </div>
                
                <div class="mt-6 flex space-x-3">
                    <button onclick="saveContent()" class="admin-btn">ğŸ’¾ Sauvegarder le contenu</button>
                    <button onclick="loadDefaultContent()" class="admin-btn" style="background: #f39c12;">ğŸ”„ Charger contenu par dÃ©faut</button>
                    <button onclick="exportContent()" class="admin-btn" style="background: #2ecc71;">ğŸ“¤ Exporter contenu</button>
                    <button onclick="importContent()" class="admin-btn" style="background: #9b59b6;">ğŸ“¥ Importer contenu</button>
                </div>
            </div>

            <!-- Google Apps Script -->
            <div class="admin-section">
                <h2 class="text-xl font-bold mb-4">ğŸ“Š Google Apps Script</h2>
                
                <p class="mb-4 text-sm text-gray-300">Configurez Google Sheets comme base de donnÃ©es :</p>
                
                <div class="bg-gray-800 p-4 rounded-lg mb-4">
                    <h4 class="text-sm font-bold mb-2 text-green-400">Instructions de configuration :</h4>
                    <ol class="text-xs space-y-1 text-gray-300">
                        <li>1. CrÃ©ez un nouveau Google Sheet</li>
                        <li>2. Allez dans Extensions â†’ Apps Script</li>
                        <li>3. Collez le code Apps Script ci-dessous</li>
                        <li>4. DÃ©ployez comme application web</li>
                        <li>5. Copiez l'URL de dÃ©ploiement dans la config</li>
                    </ol>
                </div>
                
                <div class="space-y-3 mb-4">
                    <button onclick="generateAppsScript()" class="admin-btn w-full" style="background: #34a853;">ğŸ“‹ GÃ©nÃ©rer le code Apps Script</button>
                    <button onclick="testConnection()" class="admin-btn w-full" style="background: #4285f4;">ğŸ”— Tester la connexion</button>
                    <button onclick="createSampleSheet()" class="admin-btn w-full" style="background: #fbbc04;">ğŸ“„ CrÃ©er feuille exemple</button>
                </div>
            </div>

            <!-- DÃ©ploiement -->
            <div class="admin-section">
                <h2 class="text-xl font-bold mb-4">ğŸš€ DÃ©ploiement</h2>
                
                <p class="mb-4">DÃ©ployez votre PrayLink configurÃ© :</p>
                
                <div class="space-y-3 mb-4">
                    <button onclick="downloadApp()" class="admin-btn w-full" style="background: #2ecc71;">ğŸ“± TÃ©lÃ©charger l'app configurÃ©e</button>
                    <button onclick="generateVercelConfig()" class="admin-btn w-full" style="background: #000;">âš¡ GÃ©nÃ©rer config Vercel</button>
                    <button onclick="generateQR()" class="admin-btn w-full" style="background: #f39c12;">ğŸ“± GÃ©nÃ©rer QR Code</button>
                </div>
                
                <div class="bg-gray-800 p-4 rounded-lg">
                    <h4 class="text-sm font-bold mb-2 text-green-400">Instructions Vercel :</h4>
                    <ol class="text-xs space-y-1 text-gray-300">
                        <li>1. TÃ©lÃ©chargez l'app configurÃ©e</li>
                        <li>2. CrÃ©ez un repo GitHub avec le fichier</li>
                        <li>3. Connectez le repo Ã  Vercel</li>
                        <li>4. DÃ©ployez automatiquement !</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <div class="app-container">
        
        <!-- Page 1: Accueil -->
        <div id="welcomePage" class="gradient-bg h-screen flex flex-col justify-center items-center text-white p-8">
            <div class="text-center mb-12">
                <div class="w-32 h-32 bg-white rounded-full mx-auto mb-6 flex items-center justify-center text-6xl pulse-effect">
                    ğŸ™
                </div>
                <h1 class="text-4xl font-bold mb-4">PrayLink</h1>
                <p class="text-lg opacity-90">Messages anonymes bibliques</p>
            </div>
            
            <div class="w-full max-w-sm">
                <button onclick="goToPage('platformPage')" class="w-full bg-white text-gray-900 font-bold py-4 px-6 rounded-2xl text-lg mb-6 shadow-lg interactive-btn">
                    ğŸš€ DÃ©marrer
                </button>
                
                <!-- Admin cachÃ© - Ctrl+Alt+B -->
                <div class="text-center">
                    <span class="text-white opacity-10 text-xs">v2.1</span>
                </div>
            </div>
        </div>

        <!-- Page 2: Choix de plateforme -->
        <div id="platformPage" class="hidden h-screen bg-white p-6 flex flex-col">
            <div class="flex items-center mb-8">
                <button onclick="goToPage('welcomePage')" class="text-2xl interactive-btn">â†</button>
                <h2 class="text-xl font-semibold ml-4">Choisir une plateforme</h2>
            </div>
            
            <div class="flex-1 flex flex-col justify-center">
                <p class="text-center text-gray-600 mb-8">Sous quel nom veux-tu utiliser PrayLink ?</p>
                
                <div class="space-y-4 mb-8">
                    <button onclick="selectPlatform('instagram')" class="w-full flex items-center justify-between p-4 border-2 border-gray-200 rounded-xl interactive-btn hover:border-purple-500">
                        <div class="flex items-center">
                            <div class="w-12 h-12 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl flex items-center justify-center text-white text-xl mr-4">
                                ğŸ“·
                            </div>
                            <span class="font-medium">Instagram</span>
                        </div>
                        <span class="text-gray-400 text-2xl">â†’</span>
                    </button>
                    
                    <button onclick="selectPlatform('whatsapp')" class="w-full flex items-center justify-between p-4 border-2 border-gray-200 rounded-xl interactive-btn hover:border-green-500">
                        <div class="flex items-center">
                            <div class="w-12 h-12 bg-green-500 rounded-xl flex items-center justify-center text-white text-xl mr-4">
                                ğŸ“±
                            </div>
                            <span class="font-medium">WhatsApp</span>
                        </div>
                        <span class="text-gray-400 text-2xl">â†’</span>
                    </button>
                    
                    <button onclick="selectPlatform('snapchat')" class="w-full flex items-center justify-between p-4 border-2 border-gray-200 rounded-xl interactive-btn hover:border-yellow-500">
                        <div class="flex items-center">
                            <div class="w-12 h-12 bg-yellow-400 rounded-xl flex items-center justify-center text-gray-800 text-xl mr-4">
                                ğŸ‘»
                            </div>
                            <span class="font-medium">Snapchat</span>
                        </div>
                        <span class="text-gray-400 text-2xl">â†’</span>
                    </button>
                </div>
                
                <button onclick="goToPage('usernamePage')" class="w-full bg-gray-900 text-white font-semibold py-4 rounded-xl interactive-btn">
                    Continuer
                </button>
            </div>
        </div>

        <!-- Page 3: Nom d'utilisateur -->
        <div id="usernamePage" class="hidden h-screen bg-white p-6 flex flex-col">
            <div class="flex items-center mb-8">
                <button onclick="goToPage('platformPage')" class="text-2xl interactive-btn">â†</button>
                <h2 class="text-xl font-semibold ml-4">Nom d'utilisateur</h2>
            </div>
            
            <div class="flex-1 flex flex-col justify-center">
                <p class="text-center text-gray-600 mb-8">Choisis ton nom d'utilisateur</p>
                
                <div class="mb-6">
                    <input type="text" id="usernameInput" placeholder="@tonnom" 
                           class="w-full px-4 py-4 border-2 border-gray-200 rounded-xl text-lg focus:border-purple-500 focus:outline-none">
                </div>
                
                <button onclick="goToPage('profilePhotoPage')" class="w-full bg-gray-900 text-white font-semibold py-4 rounded-xl mb-4 interactive-btn">
                    Continuer
                </button>
            </div>
        </div>

        <!-- Page 4: Photo de profil -->
        <div id="profilePhotoPage" class="hidden h-screen bg-white p-6 flex flex-col">
            <div class="flex items-center mb-8">
                <button onclick="goToPage('usernamePage')" class="text-2xl interactive-btn">â†</button>
                <h2 class="text-xl font-semibold ml-4">Photo de profil</h2>
            </div>
            
            <div class="flex-1 flex flex-col justify-center items-center">
                <p class="text-center text-gray-600 mb-8">Choisis une photo pour ton profil</p>
                
                <div class="w-32 h-32 bg-gray-200 rounded-full mb-8 flex items-center justify-center text-4xl cursor-pointer interactive-btn" onclick="selectProfilePhoto()">
                    <span id="profileEmoji">ğŸ“·</span>
                </div>
                
                <div class="grid grid-cols-4 gap-4 mb-8">
                    <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center text-2xl cursor-pointer interactive-btn" onclick="setProfileEmoji('ğŸ™')">ğŸ™</div>
                    <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center text-2xl cursor-pointer interactive-btn" onclick="setProfileEmoji('âœ¨')">âœ¨</div>
                    <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center text-2xl cursor-pointer interactive-btn" onclick="setProfileEmoji('ğŸ’«')">ğŸ’«</div>
                    <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center text-2xl cursor-pointer interactive-btn" onclick="setProfileEmoji('ğŸŒŸ')">ğŸŒŸ</div>
                    <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center text-2xl cursor-pointer interactive-btn" onclick="setProfileEmoji('ğŸ’')">ğŸ’</div>
                    <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center text-2xl cursor-pointer interactive-btn" onclick="setProfileEmoji('ğŸ•Šï¸')">ğŸ•Šï¸</div>
                    <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center text-2xl cursor-pointer interactive-btn" onclick="setProfileEmoji('ğŸ‘¼')">ğŸ‘¼</div>
                    <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center text-2xl cursor-pointer interactive-btn" onclick="setProfileEmoji('ğŸ¯')">ğŸ¯</div>
                </div>
                
                <div class="w-full space-y-3">
                    <button onclick="goToPage('mainPage')" class="w-full bg-gray-900 text-white font-semibold py-4 rounded-xl interactive-btn">
                        Continuer
                    </button>
                    <button onclick="goToPage('mainPage')" class="w-full text-gray-500 py-2 interactive-btn">
                        Ignorer
                    </button>
                </div>
            </div>
        </div>

        <!-- Page principale -->
        <div id="mainPage" class="hidden h-screen bg-white flex flex-col">
            <!-- Header -->
            <div class="flex items-center justify-between p-4 border-b">
                <h1 class="text-xl font-bold">PrayLink</h1>
                <div class="flex items-center space-x-4">
                    <button onclick="showTab('inbox')" class="relative interactive-btn">
                        <span class="text-2xl">ğŸ“¬</span>
                        <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center pulse-effect" id="messageCount">3</span>
                    </button>
                </div>
            </div>
            
            <!-- Navigation -->
            <div class="flex border-b">
                <button onclick="showTab('share')" class="flex-1 py-4 text-center font-medium border-b-2 border-purple-600 text-purple-600 interactive-btn" id="shareTab">
                    Partager
                </button>
                <button onclick="showTab('games')" class="flex-1 py-4 text-center font-medium text-gray-500 interactive-btn" id="gamesTab">
                    Jeux
                </button>
                <button onclick="showTab('inbox')" class="flex-1 py-4 text-center font-medium text-gray-500 interactive-btn" id="inboxTab">
                    Inbox
                </button>
            </div>
            
            <!-- Share Content -->
            <div id="shareContent" class="flex-1 flex flex-col overflow-y-auto">
                <!-- Profil principal -->
                <div class="p-6 border-b bg-white">
                    <div class="flex items-center mb-4">
                        <div class="w-20 h-20 bg-gradient-to-br from-purple-600 to-pink-600 rounded-full flex items-center justify-center text-3xl shadow-lg mr-4 pulse-effect">
                            <span id="mainProfileEmoji">ğŸ™</span>
                        </div>
                        <div class="flex-1">
                            <h2 class="text-xl font-bold mb-1" id="mainUsername">@PrayerWarrior</h2>
                            <p class="text-gray-600 text-sm">Messages anonymes bibliques ğŸ“–</p>
                        </div>
                    </div>
                    
                    <div class="flex space-x-6">
                        <div class="text-center">
                            <div class="text-lg font-bold text-gray-900" id="userMessagesCount">12</div>
                            <div class="text-xs text-gray-500">Messages</div>
                        </div>
                        <div class="text-center">
                            <div class="text-lg font-bold text-gray-900" id="userResponsesCount">8</div>
                            <div class="text-xs text-gray-500">RÃ©ponses</div>
                        </div>
                        <div class="text-center">
                            <div class="text-lg font-bold text-gray-900" id="userSharesCount">25</div>
                            <div class="text-xs text-gray-500">Partages</div>
                        </div>
                    </div>
                </div>
                
                <!-- Lien de Partage -->
                <div class="p-6">
                    <h3 class="text-lg font-semibold mb-2 text-blue-600">ğŸ”— Mon Lien de Partage</h3>
                    <p class="text-sm text-gray-600 mb-4">
                        Partagez ce lien pour que vos amis puissent vous envoyer des messages anonymes.
                    </p>
                    
                    <div class="bg-gray-100 rounded-xl p-4 mb-4">
                        <div class="text-xs text-gray-500 mb-1">Votre lien Ã  partager :</div>
                        <div class="text-sm font-mono break-all" id="universalLink">https://praylink.app/u/prayerwarrior</div>
                    </div>
                    
                    <div class="flex space-x-2">
                        <button onclick="copyUniversalLink()" class="flex-1 bg-blue-500 text-white py-3 rounded-lg text-sm font-medium interactive-btn">
                            ğŸ“‹ Copier
                        </button>
                        <button onclick="shareUniversalLink()" class="flex-1 bg-green-500 text-white py-3 rounded-lg text-sm font-medium interactive-btn">
                            ğŸ“± Partager
                        </button>
                    </div>
                </div>

                <!-- Lien Personnel -->
                <div class="p-6 border-t">
                    <h3 class="text-lg font-semibold mb-2 text-red-600">ğŸ”’ Votre Lien Personnel</h3>
                    <p class="text-sm text-gray-600 mb-4">
                        Ne partagez <strong>jamais</strong> ce lien. C'est votre accÃ¨s unique Ã  ce tableau de bord. Si vous le perdez, votre compte sera perdu.
                    </p>
                    
                    <div class="bg-gray-100 rounded-xl p-4 mb-4">
                        <div class="text-xs text-gray-500 mb-1">Votre lien d'accÃ¨s personnel :</div>
                        <div class="text-sm font-mono break-all" id="personalAccessLink">https://praylink-beta.vercel.app/</div>
                    </div>
                    
                    <button onclick="copyPersonalLink()" class="w-full bg-red-500 text-white py-3 rounded-lg text-sm font-medium interactive-btn">
                        ğŸ“‹ Copier mon lien personnel
                    </button>
                </div>

                <!-- Section de partage de contenu -->
                <div class="p-6 border-t">
                    <h3 class="text-lg font-semibold mb-4">ğŸ“¤ Partager du contenu</h3>
                    
                    <div class="space-y-3">
                        <button onclick="shareRandomVerse()" class="w-full bg-gradient-to-r from-indigo-500 to-blue-600 text-white p-4 rounded-2xl text-left interactive-btn">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="font-bold mb-1">ğŸ“– Verset du jour</div>
                                    <div class="text-sm opacity-90">Partager un verset inspirant</div>
                                </div>
                                <span class="text-2xl">ğŸ“±</span>
                            </div>
                        </button>
                        
                        <button onclick="shareRandomPrayer()" class="w-full bg-gradient-to-r from-emerald-500 to-green-600 text-white p-4 rounded-2xl text-left interactive-btn">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="font-bold mb-1">ğŸ™ PriÃ¨re du jour</div>
                                    <div class="text-sm opacity-90">Partager une priÃ¨re</div>
                                </div>
                                <span class="text-2xl">ğŸ“±</span>
                            </div>
                        </button>
                        
                        <button onclick="shareRandomTestimony()" class="w-full bg-gradient-to-r from-amber-500 to-orange-600 text-white p-4 rounded-2xl text-left interactive-btn">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="font-bold mb-1">âœ¨ TÃ©moignage</div>
                                    <div class="text-sm opacity-90">Partager un tÃ©moignage</div>
                                </div>
                                <span class="text-2xl">ğŸ“±</span>
                            </div>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Games Content -->
            <div id="gamesContent" class="hidden flex-1 p-4 overflow-y-auto">
                <div class="text-center mb-6">
                    <h3 class="text-lg font-semibold mb-2">Jeux Bibliques</h3>
                    <p class="text-gray-600 text-sm">DÃ©couvre la Bible en t'amusant !</p>
                </div>
                
                <div class="space-y-4">
                    <!-- Quiz Biblique -->
                    <div class="bg-gradient-to-r from-blue-500 to-indigo-600 rounded-2xl p-6 text-white">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <h4 class="text-lg font-bold">ğŸ“– Quiz Biblique Infini</h4>
                                <p class="text-sm opacity-90">Questions illimitÃ©es avec chrono</p>
                            </div>
                            <div class="text-3xl pulse-effect">ğŸ§ </div>
                        </div>
                        <button onclick="startBibleQuiz()" class="w-full bg-white bg-opacity-20 text-white font-semibold py-3 rounded-xl hover:bg-opacity-30 transition-all interactive-btn">
                            ğŸ® Jouer maintenant
                        </button>
                    </div>
                    
                    <!-- Trouve le Verset -->
                    <div class="bg-gradient-to-r from-purple-500 to-pink-600 rounded-2xl p-6 text-white">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <h4 class="text-lg font-bold">ğŸ” Trouve le Verset Infini</h4>
                                <p class="text-sm opacity-90">Versets alÃ©atoires sans fin</p>
                            </div>
                            <div class="text-3xl pulse-effect">ğŸ“œ</div>
                        </div>
                        <button onclick="startVerseGame()" class="w-full bg-white bg-opacity-20 text-white font-semibold py-3 rounded-xl hover:bg-opacity-30 transition-all interactive-btn">
                            ğŸ® Jouer maintenant
                        </button>
                    </div>
                    
                    <!-- MÃ©moire Biblique -->
                    <div class="bg-gradient-to-r from-green-500 to-emerald-600 rounded-2xl p-6 text-white">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <h4 class="text-lg font-bold">ğŸ§© MÃ©moire Biblique Infinie</h4>
                                <p class="text-sm opacity-90">Parties consÃ©cutives automatiques</p>
                            </div>
                            <div class="text-3xl pulse-effect">ğŸ¯</div>
                        </div>
                        <button onclick="startMemoryGame()" class="w-full bg-white bg-opacity-20 text-white font-semibold py-3 rounded-xl hover:bg-opacity-30 transition-all interactive-btn">
                            ğŸ® Jouer maintenant
                        </button>
                    </div>
                    
                    <!-- Devine le Personnage -->
                    <div class="bg-gradient-to-r from-orange-500 to-red-600 rounded-2xl p-6 text-white">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <h4 class="text-lg font-bold">ğŸ‘¤ Devine le Personnage Infini</h4>
                                <p class="text-sm opacity-90">Personnages alÃ©atoires avec indices</p>
                            </div>
                            <div class="text-3xl pulse-effect">ğŸ­</div>
                        </div>
                        <button onclick="startCharacterGame()" class="w-full bg-white bg-opacity-20 text-white font-semibold py-3 rounded-xl hover:bg-opacity-30 transition-all interactive-btn">
                            ğŸ® Jouer maintenant
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Inbox Content -->
            <div id="inboxContent" class="hidden flex-1 flex flex-col">
            <div id="inboxContent" class="hidden flex-1 flex flex-col overflow-y-auto">
                <div class="flex items-center justify-between p-4 border-b bg-white">
                    <h3 class="text-lg font-semibold">Messages reÃ§us</h3>
                    <button onclick="refreshInbox()" class="bg-purple-600 text-white px-3 py-2 rounded-full text-sm font-medium interactive-btn">
                        ğŸ”„ Actualiser
                    </button>
                </div>
                
                <div class="flex-1 overflow-y-auto p-4 space-y-4" id="messagesList">
                <div class="p-4 space-y-4" id="messagesList">
                    <!-- Messages exemple -->
                    <div class="bg-white rounded-2xl p-4 border border-gray-200">
                        <div class="flex items-start justify-between mb-2">
                            <div class="text-sm text-gray-500">Anonyme â€¢ il y a 2h</div>
                            <div class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full">Question</div>
                        </div>
                        <p class="text-gray-800 mb-3">"Quel est ton verset prÃ©fÃ©rÃ© et pourquoi ?"</p>
                        <button onclick="openResponsePage('Anonyme', 'Quel est ton verset prÃ©fÃ©rÃ© et pourquoi ?', 'question')" class="bg-purple-600 text-white px-4 py-2 rounded-full text-sm font-medium interactive-btn">
                            ğŸ’¬ RÃ©pondre
                        </button>
                    </div>
                    
                    <div class="bg-white rounded-2xl p-4 border border-gray-200">
                        <div class="flex items-start justify-between mb-2">
                            <div class="text-sm text-gray-500">Anonyme â€¢ il y a 5h</div>
                            <div class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full">PriÃ¨re</div>
                        </div>
                        <p class="text-gray-800 mb-3">"Peux-tu prier pour ma famille ? Nous traversons une pÃ©riode difficile."</p>
                        <button onclick="openResponsePage('Anonyme', 'Peux-tu prier pour ma famille ? Nous traversons une pÃ©riode difficile.', 'prayer')" class="bg-green-600 text-white px-4 py-2 rounded-full text-sm font-medium interactive-btn">
                            ğŸ™ RÃ©pondre
                        </button>
                    </div>
                    
                    <div class="bg-white rounded-2xl p-4 border border-gray-200">
                        <div class="flex items-start justify-between mb-2">
                            <div class="text-sm text-gray-500">Anonyme â€¢ hier</div>
                            <div class="text-xs bg-purple-100 text-purple-800 px-2 py-1 rounded-full">TÃ©moignage</div>
                        </div>
                        <p class="text-gray-800 mb-3">"Merci pour tes messages inspirants ! Ils m'aident beaucoup. ğŸ™"</p>
                        <button onclick="openResponsePage('Anonyme', 'Merci pour tes messages inspirants ! Ils m\'aident beaucoup. ğŸ™', 'testimony')" class="bg-orange-600 text-white px-4 py-2 rounded-full text-sm font-medium interactive-btn">
                            â¤ï¸ RÃ©pondre
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentPage = 'welcomePage';
        let selectedPlatform = '';
        let username = '';
        let profileEmoji = 'ğŸ™';
        let appConfig = {
            name: 'PrayLink',
            baseUrl: 'https://praylink-beta.vercel.app',
            scriptUrl: 'https://script.google.com/macros/s/AKfycbznqEPPRCC79rujx_rKALbzHftiJIZ2WP0-F-jPZ-GDNh6zT0sWCwhyyvNOVdmuR4oiMA/exec',
            sheetId: 'https://docs.google.com/spreadsheets/d/1hXfUYuSlyTHkXyZkEiTMb5h1wvK89iWgROlu5YQsMBk/edit?usp=sharing'
        };

        // ===== NAVIGATION =====
        function goToPage(pageId) {
            document.querySelectorAll('.app-container > div').forEach(page => {
                page.classList.add('hidden');
            });
            document.getElementById(pageId).classList.remove('hidden');
            currentPage = pageId;
            
            if (pageId === 'mainPage') {
                // If we are arriving here from setup, username might not be set yet.
                if (!username) {
                    const usernameInput = document.getElementById('usernameInput');
                    if (usernameInput && usernameInput.value) {
                        username = usernameInput.value.replace('@', '');
                    }
                    if (!username) username = 'PrayerWarrior'; // default
                }

                // Save profile to localStorage
                const userProfile = {
                    username: username,
                    emoji: profileEmoji
                };
                localStorage.setItem('praylink_userProfile', JSON.stringify(userProfile));

                updateUserProfile(); // This sets the UI elements
                updateUniversalLink(); // This sets the shareable link
                updatePersonalLink(); // This sets the personal link
            }
        }

        function selectPlatform(platform) {
            selectedPlatform = platform;
            document.querySelectorAll('#platformPage button').forEach(btn => {
                btn.classList.remove('border-purple-500', 'border-green-500', 'border-yellow-500');
                btn.classList.add('border-gray-200');
            });
            event.target.closest('button').classList.remove('border-gray-200');
            if (platform === 'instagram') event.target.closest('button').classList.add('border-purple-500');
            if (platform === 'whatsapp') event.target.closest('button').classList.add('border-green-500');
            if (platform === 'snapchat') event.target.closest('button').classList.add('border-yellow-500');
        }

        function setProfileEmoji(emoji) {
            profileEmoji = emoji;
            document.getElementById('profileEmoji').textContent = emoji;
        }

        function updateUserProfile() {
            const usernameInput = document.getElementById('usernameInput');
            if (usernameInput && usernameInput.value) {
                username = usernameInput.value.replace('@', '');
            }
            if (!username) username = 'PrayerWarrior';
            
            document.getElementById('mainUsername').textContent = '@' + username;
            document.getElementById('mainProfileEmoji').textContent = profileEmoji;
        }

        function updateUniversalLink() {
            const link = `${appConfig.baseUrl}/u/${username}`;
            document.getElementById('universalLink').textContent = link;
        }

        // ===== ONGLETS =====
        function showTab(tabName) {
            // Cacher tous les contenus
            document.getElementById('shareContent').classList.add('hidden');
            document.getElementById('gamesContent').classList.add('hidden');
            document.getElementById('inboxContent').classList.add('hidden');
            
            // RÃ©initialiser les styles des onglets
            document.getElementById('shareTab').classList.remove('border-purple-600', 'text-purple-600');
            document.getElementById('shareTab').classList.add('text-gray-500');
            document.getElementById('gamesTab').classList.remove('border-purple-600', 'text-purple-600');
            document.getElementById('gamesTab').classList.add('text-gray-500');
            document.getElementById('inboxTab').classList.remove('border-purple-600', 'text-purple-600');
            document.getElementById('inboxTab').classList.add('text-gray-500');
            
            // Afficher le contenu sÃ©lectionnÃ©
            if (tabName === 'share') {
                document.getElementById('shareContent').classList.remove('hidden');
                document.getElementById('shareTab').classList.add('border-purple-600', 'text-purple-600');
                document.getElementById('shareTab').classList.remove('text-gray-500');
            } else if (tabName === 'games') {
                document.getElementById('gamesContent').classList.remove('hidden');
                document.getElementById('gamesTab').classList.add('border-purple-600', 'text-purple-600');
                document.getElementById('gamesTab').classList.remove('text-gray-500');
            } else if (tabName === 'inbox') {
                document.getElementById('inboxContent').classList.remove('hidden');
                document.getElementById('inboxTab').classList.add('border-purple-600', 'text-purple-600');
                document.getElementById('inboxTab').classList.remove('text-gray-500');
            }
        }

        // ===== LIEN UNIVERSEL =====
        function copyUniversalLink() {
            const link = document.getElementById('universalLink').textContent;
            navigator.clipboard.writeText(link).then(() => {
                showNotification('ğŸ“‹ Lien copiÃ© !');
            }).catch(() => {
                showNotification('âŒ Erreur lors de la copie');
            });
        }

        function shareUniversalLink() {
            const link = document.getElementById('universalLink').textContent;
            if (navigator.share) {
                navigator.share({
                    title: 'Mon PrayLink',
                    text: 'Envoie-moi un message anonyme sur PrayLink !',
                    url: link
                });
            } else {
                copyUniversalLink();
                showNotification('ğŸ“± Lien copiÃ© ! Partage-le manuellement.');
            }
        }

        function updatePersonalLink() {
            const link = appConfig.baseUrl + '/';
            document.getElementById('personalAccessLink').textContent = link;
        }

        function copyPersonalLink() {
            const link = document.getElementById('personalAccessLink').textContent;
            navigator.clipboard.writeText(link).then(() => {
                showNotification('ğŸ“‹ Lien personnel copiÃ© ! Gardez-le en sÃ©curitÃ©.');
            }).catch(() => {
                showNotification('âŒ Erreur lors de la copie');
            });
        }

        // ===== PAGE DE RÃ‰PONSE =====
        function openResponsePage(sender, message, context) {
            document.getElementById('responseRecipient').textContent = '@' + username;
            document.getElementById('originalMessage').textContent = '"' + message + '"';
            document.getElementById('responseContext').textContent = context.charAt(0).toUpperCase() + context.slice(1);
            
            // Cacher l'app principale et afficher la page de rÃ©ponse
            document.querySelector('.app-container').style.display = 'none';
            document.getElementById('responsePage').classList.remove('hidden');
        }

        function sendAnonymousResponse() {
            const responseText = document.getElementById('responseText').value;
            
            if (!responseText.trim()) {
                showNotification('âŒ Ã‰cris une rÃ©ponse avant d\'envoyer');
                return;
            }
            
            // Envoyer Ã  Google Sheets
            const messageData = {
                action: 'sendMessage',
                recipient: document.getElementById('responseRecipient').textContent.replace('@', ''),
                message: responseText,
                context: document.getElementById('responseContext').textContent,
                timestamp: new Date().toISOString(),
                sender: 'Anonyme'
            };
            
            sendToGoogleSheets(messageData);
            
            showNotification('âœ… RÃ©ponse envoyÃ©e anonymement !');
            document.getElementById('responseText').value = '';
            
            setTimeout(() => {
                document.getElementById('responsePage').classList.add('hidden');
                document.querySelector('.app-container').style.display = 'block';
            }, 2000);
        }

        function addEmoji() {
            const emojis = ['ğŸ˜Š', 'ğŸ™', 'â¤ï¸', 'âœ¨', 'ğŸŒŸ', 'ğŸ’«', 'ğŸ•Šï¸', 'ğŸ‘¼'];
            const randomEmoji = emojis[Math.floor(Math.random() * emojis.length)];
            const textarea = document.getElementById('responseText');
            textarea.value += ' ' + randomEmoji;
            textarea.focus();
        }

        function createMyPrayLink() {
            document.getElementById('responsePage').classList.add('hidden');
            document.querySelector('.app-container').style.display = 'block';
            goToPage('welcomePage');
            showNotification('ğŸ™ Bienvenue sur PrayLink !');
        }

        // ===== JEUX =====

        // Quiz Biblique - Base de donnÃ©es massive et infinie
        const quizQuestions = [
            { question: "Qui a construit l'arche ?", options: ["MoÃ¯se", "NoÃ©", "Abraham", "David"], correct: 1 },
            { question: "Combien d'apÃ´tres JÃ©sus avait-il ?", options: ["10", "11", "12", "13"], correct: 2 },
            { question: "Qui a Ã©crit le livre des Psaumes ?", options: ["Salomon", "David", "MoÃ¯se", "Paul"], correct: 1 },
            { question: "Dans quelle ville JÃ©sus est-il nÃ© ?", options: ["Nazareth", "JÃ©rusalem", "BethlÃ©em", "CapharnaÃ¼m"], correct: 2 },
            { question: "Combien de jours JÃ©sus a-t-il jeÃ»nÃ© ?", options: ["30", "40", "50", "60"], correct: 1 },
            { question: "Qui a trahi JÃ©sus ?", options: ["Pierre", "Jean", "Judas", "Thomas"], correct: 2 },
            { question: "Combien de livres dans la Bible ?", options: ["64", "65", "66", "67"], correct: 2 },
            { question: "Qui a Ã©tÃ© avalÃ© par un poisson ?", options: ["Jonas", "Job", "JosuÃ©", "JÃ©rÃ©mie"], correct: 0 },
            { question: "PremiÃ¨re femme crÃ©Ã©e par Dieu ?", options: ["Marie", "Ruth", "Ãˆve", "Sarah"], correct: 2 },
            { question: "Qui a reÃ§u les 10 commandements ?", options: ["Abraham", "MoÃ¯se", "David", "Salomon"], correct: 1 },
            { question: "Combien de plaies en Ã‰gypte ?", options: ["8", "9", "10", "12"], correct: 2 },
            { question: "Qui a vaincu Goliath ?", options: ["SaÃ¼l", "David", "Jonathan", "Samuel"], correct: 1 },
            { question: "Premier roi d'IsraÃ«l ?", options: ["David", "Salomon", "SaÃ¼l", "Samuel"], correct: 2 },
            { question: "Qui a interprÃ©tÃ© les rÃªves de Pharaon ?", options: ["MoÃ¯se", "Joseph", "Aaron", "Daniel"], correct: 1 },
            { question: "Combien de disciples JÃ©sus a-t-il choisis ?", options: ["10", "11", "12", "70"], correct: 2 },
            { question: "Qui a marchÃ© sur l'eau ?", options: ["Pierre", "Jean", "JÃ©sus", "Paul"], correct: 2 },
            { question: "Premier miracle de JÃ©sus ?", options: ["GuÃ©rison", "Eau en vin", "Multiplication", "RÃ©surrection"], correct: 1 },
            { question: "Qui a niÃ© JÃ©sus 3 fois ?", options: ["Jean", "Pierre", "Thomas", "Judas"], correct: 1 },
            { question: "Montagne oÃ¹ MoÃ¯se est mort ?", options: ["SinaÃ¯", "Horeb", "NÃ©bo", "Carmel"], correct: 2 },
            { question: "Qui a construit le temple ?", options: ["David", "Salomon", "Esdras", "NÃ©hÃ©mie"], correct: 1 },
            { question: "Combien d'annÃ©es Mathusalem a-t-il vÃ©cu ?", options: ["900", "950", "969", "1000"], correct: 2 },
            { question: "Qui a Ã©tÃ© le premier martyr chrÃ©tien ?", options: ["Pierre", "Paul", "Ã‰tienne", "Jacques"], correct: 2 },
            { question: "Dans quel livre trouve-t-on l'histoire de Ruth ?", options: ["Juges", "Ruth", "1 Samuel", "Esther"], correct: 1 },
            { question: "Combien de fois par jour Daniel priait-il ?", options: ["1", "2", "3", "5"], correct: 2 },
            { question: "Qui a Ã©crit le livre de l'Apocalypse ?", options: ["Paul", "Pierre", "Jean", "Luc"], correct: 2 },
            { question: "Combien de personnes Ã©taient dans l'arche ?", options: ["6", "7", "8", "10"], correct: 2 },
            { question: "Qui Ã©tait la femme d'Abraham ?", options: ["Rebecca", "Rachel", "Sarah", "LÃ©a"], correct: 2 },
            { question: "Combien de fils Jacob avait-il ?", options: ["10", "11", "12", "13"], correct: 2 },
            { question: "Qui a succÃ©dÃ© Ã  MoÃ¯se ?", options: ["Aaron", "JosuÃ©", "Caleb", "Samuel"], correct: 1 },
            { question: "Dans quelle mer les IsraÃ©lites ont-ils traversÃ© ?", options: ["MÃ©diterranÃ©e", "Rouge", "Morte", "GalilÃ©e"], correct: 1 },
            { question: "Qui Ã©tait le pÃ¨re de Jean-Baptiste ?", options: ["Joseph", "Zacharie", "SimÃ©on", "Anne"], correct: 1 },
            { question: "Combien de jours Lazare Ã©tait-il mort ?", options: ["2", "3", "4", "7"], correct: 2 },
            { question: "Qui a vendu son droit d'aÃ®nesse ?", options: ["Jacob", "Ã‰saÃ¼", "Isaac", "Abraham"], correct: 1 },
            { question: "Combien de pains JÃ©sus a-t-il multipliÃ©s ?", options: ["3", "5", "7", "12"], correct: 1 },
            { question: "Qui Ã©tait le roi le plus sage ?", options: ["David", "Salomon", "Ã‰zÃ©chias", "Josias"], correct: 1 },
            { question: "Dans quelle ville Paul est-il nÃ© ?", options: ["JÃ©rusalem", "Tarse", "Antioche", "Damas"], correct: 1 },
            { question: "Combien de commandements Dieu a-t-il donnÃ©s ?", options: ["8", "10", "12", "15"], correct: 1 },
            { question: "Qui a baptisÃ© JÃ©sus ?", options: ["Pierre", "Jean-Baptiste", "AndrÃ©", "Philippe"], correct: 1 },
            { question: "Combien de fois faut-il pardonner ?", options: ["7 fois", "70 fois", "77 fois", "Ã€ l'infini"], correct: 3 },
            { question: "Qui Ã©tait la mÃ¨re de Samuel ?", options: ["Anne", "Ruth", "DÃ©bora", "Esther"], correct: 0 },
            { question: "Dans quel jardin Adam et Ãˆve vivaient-ils ?", options: ["GethsÃ©manÃ©", "Ã‰den", "Oliviers", "CÃ¨dres"], correct: 1 },
            { question: "Combien de tÃ©moins faut-il selon la loi ?", options: ["1", "2", "3", "7"], correct: 1 },
            { question: "Qui a Ã©crit la plupart des Proverbes ?", options: ["David", "Salomon", "Ã‰saÃ¯e", "JÃ©rÃ©mie"], correct: 1 },
            { question: "Combien d'animaux de chaque espÃ¨ce dans l'arche ?", options: ["1 paire", "2 paires", "7 paires", "Variable"], correct: 3 },
            { question: "Qui Ã©tait le frÃ¨re de MoÃ¯se ?", options: ["Aaron", "JosuÃ©", "Caleb", "Hur"], correct: 0 },
            { question: "Dans quelle ville JÃ©sus a-t-il grandi ?", options: ["BethlÃ©em", "Nazareth", "CapharnaÃ¼m", "JÃ©rusalem"], correct: 1 },
            { question: "Combien de livres dans l'Ancien Testament ?", options: ["27", "39", "46", "66"], correct: 1 },
            { question: "Qui a construit la tour de Babel ?", options: ["Nemrod", "Les hommes", "NoÃ©", "Abraham"], correct: 1 },
            { question: "Combien de plaies sur Job ?", options: ["7", "10", "12", "Nombreuses"], correct: 3 },
            { question: "Qui Ã©tait le plus petit des apÃ´tres ?", options: ["Jean", "Matthieu", "Paul", "Pierre"], correct: 2 }
        ];

        let currentQuiz = 0;
        let quizScore = 0;
        let quizStartTime = 0;
        let totalQuizTime = 0;

        function startBibleQuiz() {
            currentQuiz = 0;
            quizScore = 0;
            quizStartTime = Date.now();
            totalQuizTime = 0;
            showQuizQuestion();
        }

        function showQuizQuestion() {
            // SÃ©lectionner une question alÃ©atoire pour un jeu infini
            const randomIndex = Math.floor(Math.random() * quizQuestions.length);
            const question = quizQuestions[randomIndex];
            
            // Calculer le temps Ã©coulÃ©
            const currentTime = Date.now();
            const sessionTime = Math.floor((currentTime - quizStartTime) / 1000);
            const minutes = Math.floor(sessionTime / 60);
            const seconds = sessionTime % 60;
            
            createGameModal('Quiz Biblique Infini', `
                <div class="text-center mb-6">
                    <div class="text-4xl mb-4">ğŸ§ </div>
                    <div class="flex justify-between items-center mb-4">
                        <div class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm">
                            Question ${currentQuiz + 1}
                        </div>
                        <div class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm">
                            â±ï¸ ${minutes}:${seconds.toString().padStart(2, '0')}
                        </div>
                    </div>
                    <h3 class="text-lg font-bold mb-4">${question.question}</h3>
                </div>
                
                <div class="space-y-3 mb-6">
                    ${question.options.map((option, index) => `
                        <button onclick="selectQuizAnswer(${index}, ${question.correct})" class="w-full p-3 text-left border-2 border-gray-200 rounded-xl hover:border-blue-500 hover:bg-blue-50 transition-all interactive-btn">
                            ${String.fromCharCode(65 + index)}. ${option}
                        </button>
                    `).join('')}
                </div>
                
                <div class="flex justify-between items-center text-sm text-gray-500">
                    <div>Score: ${quizScore}/${currentQuiz}</div>
                    <div>PrÃ©cision: ${currentQuiz > 0 ? Math.round((quizScore/currentQuiz)*100) : 0}%</div>
                </div>
                
                <div class="mt-4 pt-4 border-t">
                    <button onclick="closeGameModal()" class="w-full bg-gray-100 text-gray-700 py-2 rounded-xl text-sm interactive-btn">
                        â¸ï¸ Pause
                    </button>
                </div>
            `);
        }

        function selectQuizAnswer(selectedIndex, correctIndex) {
            const isCorrect = selectedIndex === correctIndex;
            
            if (isCorrect) {
                quizScore++;
                showNotification('âœ… Bonne rÃ©ponse ! +1 point');
            } else {
                const correctOption = document.querySelector(`button[onclick*="${correctIndex}"]`).textContent;
                showNotification(`âŒ Mauvaise rÃ©ponse. C'Ã©tait: ${correctOption}`);
            }
            
            currentQuiz++;
            setTimeout(() => {
                showQuizQuestion(); // Continue infiniment
            }, 1500);
        }

        // Quiz infini - plus de rÃ©sultats finaux

        // Base de donnÃ©es de contenu Ã©tendue
        const verseGameData = [
            { incomplete: "Car Dieu a tant aimÃ© le monde qu'il a donnÃ© son Fils _____, afin que quiconque croit en lui ne pÃ©risse point.", missing: "unique", ref: "Jean 3:16" },
            { incomplete: "Je puis tout par celui qui me _____.", missing: "fortifie", ref: "Philippiens 4:13" },
            { incomplete: "Venez Ã  moi, vous tous qui Ãªtes _____ et chargÃ©s, et je vous donnerai du repos.", missing: "fatiguÃ©s", ref: "Matthieu 11:28" },
            { incomplete: "L'Ã‰ternel est mon _____, je ne manquerai de rien.", missing: "berger", ref: "Psaume 23:1" },
            { incomplete: "Cherchez premiÃ¨rement le _____ et la justice de Dieu.", missing: "royaume", ref: "Matthieu 6:33" },
            { incomplete: "Ne crains rien, car je suis avec _____.", missing: "toi", ref: "Ã‰saÃ¯e 41:10" },
            { incomplete: "Car mes _____ ne sont pas vos pensÃ©es.", missing: "pensÃ©es", ref: "Ã‰saÃ¯e 55:8" },
            { incomplete: "Remets ton sort Ã  l'_____, Et il te soutiendra.", missing: "Ã‰ternel", ref: "Psaume 55:22" },
            { incomplete: "Tout ce que vous demanderez avec _____, vous le recevrez.", missing: "foi", ref: "Matthieu 21:22" },
            { incomplete: "L'_____ de Dieu, qui surpasse toute intelligence.", missing: "amour", ref: "Ã‰phÃ©siens 3:19" },
            { incomplete: "Celui qui demeure sous l'abri du TrÃ¨s-Haut repose Ã  l'_____ du Tout-Puissant.", missing: "ombre", ref: "Psaume 91:1" },
            { incomplete: "Heureux ceux qui ont _____ sans avoir vu.", missing: "cru", ref: "Jean 20:29" },
            { incomplete: "La _____ vient de ce qu'on entend, et ce qu'on entend vient de la parole de Christ.", missing: "foi", ref: "Romains 10:17" },
            { incomplete: "Soyez dans la _____, et ne pÃ©chez point.", missing: "colÃ¨re", ref: "Ã‰phÃ©siens 4:26" },
            { incomplete: "Car lÃ  oÃ¹ est ton _____, lÃ  aussi sera ton cÅ“ur.", missing: "trÃ©sor", ref: "Matthieu 6:21" },
            { incomplete: "Celui qui cache ses _____ ne prospÃ¨re point.", missing: "transgressions", ref: "Proverbes 28:13" },
            { incomplete: "La _____ de l'Ã‰ternel est le commencement de la sagesse.", missing: "crainte", ref: "Proverbes 9:10" },
            { incomplete: "Approchez-vous de Dieu, et il s'approchera de _____.", missing: "vous", ref: "Jacques 4:8" },
            { incomplete: "Car c'est par la _____ que vous Ãªtes sauvÃ©s.", missing: "grÃ¢ce", ref: "Ã‰phÃ©siens 2:8" },
            { incomplete: "Celui qui croit au Fils a la vie _____.", missing: "Ã©ternelle", ref: "Jean 3:36" },
            { incomplete: "Il me fait reposer dans de verts _____.", missing: "pÃ¢turages", ref: "Psaume 23:2" },
            { incomplete: "MÃªme quand je marche dans la vallÃ©e de l'ombre de la _____, je ne crains aucun mal.", missing: "mort", ref: "Psaume 23:4" },
            { incomplete: "Ta _____ et ton bÃ¢ton me rassurent.", missing: "houlette", ref: "Psaume 23:4" },
            { incomplete: "Tu dresses devant moi une _____ en face de mes adversaires.", missing: "table", ref: "Psaume 23:5" },
            { incomplete: "Oui, le bonheur et la _____ m'accompagneront tous les jours de ma vie.", missing: "grÃ¢ce", ref: "Psaume 23:6" },
            { incomplete: "Au commencement Ã©tait la _____, et la Parole Ã©tait avec Dieu.", missing: "Parole", ref: "Jean 1:1" },
            { incomplete: "Et la Parole a Ã©tÃ© faite _____, et elle a habitÃ© parmi nous.", missing: "chair", ref: "Jean 1:14" },
            { incomplete: "Il Ã©tait la vraie _____, qui, en venant dans le monde, Ã©claire tout homme.", missing: "lumiÃ¨re", ref: "Jean 1:9" },
            { incomplete: "Mais Ã  tous ceux qui l'ont reÃ§ue, elle a donnÃ© le pouvoir de devenir enfants de _____.", missing: "Dieu", ref: "Jean 1:12" },
            { incomplete: "Car la _____ a Ã©tÃ© donnÃ©e par MoÃ¯se, la grÃ¢ce et la vÃ©ritÃ© sont venues par JÃ©sus-Christ.", missing: "loi", ref: "Jean 1:17" },
            { incomplete: "JÃ©sus lui dit: Je suis le _____, la vÃ©ritÃ©, et la vie.", missing: "chemin", ref: "Jean 14:6" },
            { incomplete: "Nul ne vient au _____ que par moi.", missing: "PÃ¨re", ref: "Jean 14:6" },
            { incomplete: "Dans la maison de mon PÃ¨re, il y a plusieurs _____.", missing: "demeures", ref: "Jean 14:2" },
            { incomplete: "Je vous laisse la _____, je vous donne ma paix.", missing: "paix", ref: "Jean 14:27" },
            { incomplete: "Je suis le cep, vous Ãªtes les _____.", missing: "sarments", ref: "Jean 15:5" },
            { incomplete: "Il n'y a pas de plus grand _____ que de donner sa vie pour ses amis.", missing: "amour", ref: "Jean 15:13" },
            { incomplete: "Demandez, et l'on vous _____; cherchez, et vous trouverez.", missing: "donnera", ref: "Matthieu 7:7" },
            { incomplete: "Frappez, et l'on vous _____.", missing: "ouvrira", ref: "Matthieu 7:7" },
            { incomplete: "Car quiconque demande reÃ§oit, celui qui cherche _____, et l'on ouvre Ã  celui qui frappe.", missing: "trouve", ref: "Matthieu 7:8" },
            { incomplete: "Ne vous inquiÃ©tez donc point du _____, car le lendemain aura soin de lui-mÃªme.", missing: "lendemain", ref: "Matthieu 6:34" },
            { incomplete: "Ã€ chaque jour suffit sa _____.", missing: "peine", ref: "Matthieu 6:34" },
            { incomplete: "Regardez les oiseaux du ciel: ils ne sÃ¨ment ni ne moissonnent, et votre PÃ¨re cÃ©leste les _____.", missing: "nourrit", ref: "Matthieu 6:26" },
            { incomplete: "Ne valez-vous pas beaucoup plus qu'_____?", missing: "eux", ref: "Matthieu 6:26" },
            { incomplete: "Et pourquoi vous inquiÃ©ter au sujet du vÃªtement? ConsidÃ©rez comment croissent les _____ des champs.", missing: "lis", ref: "Matthieu 6:28" },
            { incomplete: "Ils ne travaillent ni ne filent; cependant je vous dis que _____ mÃªme, dans toute sa gloire, n'a pas Ã©tÃ© vÃªtu comme l'un d'eux.", missing: "Salomon", ref: "Matthieu 6:29" },
            { incomplete: "Heureux les pauvres en _____, car le royaume des cieux est Ã  eux!", missing: "esprit", ref: "Matthieu 5:3" },
            { incomplete: "Heureux ceux qui pleurent, car ils seront _____!", missing: "consolÃ©s", ref: "Matthieu 5:4" },
            { incomplete: "Heureux les dÃ©bonnaires, car ils hÃ©riteront la _____!", missing: "terre", ref: "Matthieu 5:5" },
            { incomplete: "Heureux ceux qui ont faim et soif de la _____, car ils seront rassasiÃ©s!", missing: "justice", ref: "Matthieu 5:6" },
            { incomplete: "Heureux les misÃ©ricordieux, car ils obtiendront _____!", missing: "misÃ©ricorde", ref: "Matthieu 5:7" },
            { incomplete: "Heureux ceux qui ont le cÅ“ur _____, car ils verront Dieu!", missing: "pur", ref: "Matthieu 5:8" },
            { incomplete: "Vous Ãªtes le _____ de la terre.", missing: "sel", ref: "Matthieu 5:13" },
            { incomplete: "Vous Ãªtes la _____ du monde.", missing: "lumiÃ¨re", ref: "Matthieu 5:14" },
            { incomplete: "Que votre lumiÃ¨re luise ainsi devant les hommes, afin qu'ils voient vos bonnes _____ et qu'ils glorifient votre PÃ¨re qui est dans les cieux.", missing: "Å“uvres", ref: "Matthieu 5:16" },
            { incomplete: "Car mes _____ ne sont pas vos voies, dit l'Ã‰ternel.", missing: "voies", ref: "Ã‰saÃ¯e 55:8" },
            { incomplete: "Autant les cieux sont Ã©levÃ©s au-dessus de la terre, autant mes voies sont Ã©levÃ©es au-dessus de vos _____.", missing: "voies", ref: "Ã‰saÃ¯e 55:9" },
            { incomplete: "Ainsi en est-il de ma parole qui sort de ma bouche: Elle ne retourne point Ã  moi sans _____.", missing: "effet", ref: "Ã‰saÃ¯e 55:11" },
            { incomplete: "Mais elle accomplit ce que je veux, Et elle rÃ©ussit dans ce pour quoi je l'ai _____.", missing: "envoyÃ©e", ref: "Ã‰saÃ¯e 55:11" },
            { incomplete: "L'Ã‰ternel est prÃ¨s de ceux qui ont le cÅ“ur _____.", missing: "brisÃ©", ref: "Psaume 34:18" },
            { incomplete: "Et il sauve ceux qui ont l'esprit dans l'_____.", missing: "abattement", ref: "Psaume 34:18" },
            { incomplete: "GoÃ»tez et voyez combien l'Ã‰ternel est _____!", missing: "bon", ref: "Psaume 34:8" },
            { incomplete: "Heureux l'homme qui cherche en lui son _____!", missing: "refuge", ref: "Psaume 34:8" }
        ];

        const bibleVerses = [
            { text: "Car Dieu a tant aimÃ© le monde qu'il a donnÃ© son Fils unique, afin que quiconque croit en lui ne pÃ©risse point, mais qu'il ait la vie Ã©ternelle.", ref: "Jean 3:16" },
            { text: "Je puis tout par celui qui me fortifie.", ref: "Philippiens 4:13" },
            { text: "L'Ã‰ternel est mon berger, je ne manquerai de rien.", ref: "Psaume 23:1" },
            { text: "Venez Ã  moi, vous tous qui Ãªtes fatiguÃ©s et chargÃ©s, et je vous donnerai du repos.", ref: "Matthieu 11:28" },
            { text: "Cherchez premiÃ¨rement le royaume et la justice de Dieu, et toutes ces choses vous seront donnÃ©es par-dessus.", ref: "Matthieu 6:33" },
            { text: "Ne crains rien, car je suis avec toi; Ne promÃ¨ne pas des regards inquiets, car je suis ton Dieu.", ref: "Ã‰saÃ¯e 41:10" },
            { text: "Car mes pensÃ©es ne sont pas vos pensÃ©es, Et vos voies ne sont pas mes voies, Dit l'Ã‰ternel.", ref: "Ã‰saÃ¯e 55:8" },
            { text: "Remets ton sort Ã  l'Ã‰ternel, Et il te soutiendra, Il ne laissera jamais chanceler le juste.", ref: "Psaume 55:22" }
        ];

        const prayers = [
            { title: "PriÃ¨re du matin", text: "Seigneur, merci pour cette nouvelle journÃ©e. Guide mes pas et que ta volontÃ© soit faite. Amen." },
            { title: "PriÃ¨re de protection", text: "PÃ¨re cÃ©leste, protÃ¨ge ma famille et mes proches. Couvre-nous de ton amour et de ta paix. Amen." },
            { title: "PriÃ¨re de gratitude", text: "Merci Seigneur pour toutes tes bÃ©nÃ©dictions. Tu es fidÃ¨le et bon en tout temps. Amen." },
            { title: "PriÃ¨re pour la sagesse", text: "Dieu tout-puissant, accorde-moi la sagesse pour prendre les bonnes dÃ©cisions. Ã‰claire mon chemin. Amen." },
            { title: "PriÃ¨re de pardon", text: "Seigneur, pardonne-moi mes fautes. Aide-moi Ã  pardonner Ã  ceux qui m'ont blessÃ©. Amen." },
            { title: "PriÃ¨re du soir", text: "PÃ¨re, merci pour cette journÃ©e. Pardonne mes erreurs et accorde-moi un repos paisible. Amen." },
            { title: "PriÃ¨re pour la paix", text: "Prince de la paix, apaise mon cÅ“ur troublÃ©. Que ta paix qui surpasse toute intelligence garde mon esprit. Amen." },
            { title: "PriÃ¨re pour la force", text: "Dieu tout-puissant, donne-moi la force de surmonter les Ã©preuves. Tu es ma force et mon bouclier. Amen." },
            { title: "PriÃ¨re pour la guÃ©rison", text: "JÃ©sus, grand mÃ©decin, touche et guÃ©ris ceux qui souffrent. Que ta puissance de guÃ©rison se manifeste. Amen." },
            { title: "PriÃ¨re pour la famille", text: "Seigneur, bÃ©nis ma famille. Unis-nous dans l'amour et protÃ¨ge chacun de nous. Amen." },
            { title: "PriÃ¨re pour le travail", text: "PÃ¨re, bÃ©nis le travail de mes mains. Que tout ce que je fais soit pour ta gloire. Amen." },
            { title: "PriÃ¨re pour les finances", text: "Dieu pourvoyeur, tu connais mes besoins. Aide-moi Ã  Ãªtre un bon gestionnaire de tes bÃ©nÃ©dictions. Amen." },
            { title: "PriÃ¨re pour les malades", text: "Seigneur, touche ceux qui sont malades. Apporte la guÃ©rison et le rÃ©confort Ã  ceux qui souffrent. Amen." },
            { title: "PriÃ¨re pour les dirigeants", text: "PÃ¨re, guide nos dirigeants. Donne-leur la sagesse pour prendre de bonnes dÃ©cisions pour notre nation. Amen." },
            { title: "PriÃ¨re pour l'Ã‰glise", text: "JÃ©sus, bÃ©nis ton Ã‰glise. Que nous soyons unis dans l'amour et fidÃ¨les Ã  ta Parole. Amen." },
            { title: "PriÃ¨re pour les missions", text: "Seigneur, bÃ©nis les missionnaires dans le monde. Ouvre les cÅ“urs Ã  l'Ã‰vangile. Amen." },
            { title: "PriÃ¨re pour les jeunes", text: "PÃ¨re, guide nos jeunes. ProtÃ¨ge-les des tentations et aide-les Ã  marcher dans tes voies. Amen." },
            { title: "PriÃ¨re pour les personnes Ã¢gÃ©es", text: "Seigneur, bÃ©nis nos aÃ®nÃ©s. Donne-leur la santÃ©, la joie et le sentiment d'Ãªtre utiles. Amen." },
            { title: "PriÃ¨re pour la patience", text: "Dieu de patience, aide-moi Ã  attendre tes temps parfaits. Enseigne-moi la patience dans les Ã©preuves. Amen." },
            { title: "PriÃ¨re pour l'humilitÃ©", text: "JÃ©sus, modÃ¨le d'humilitÃ©, aide-moi Ã  marcher humblement devant toi et devant les autres. Amen." },
            { title: "PriÃ¨re pour la joie", text: "Dieu de joie, remplis mon cÅ“ur de ta joie parfaite qui ne dÃ©pend pas des circonstances. Amen." },
            { title: "PriÃ¨re pour l'espÃ©rance", text: "Dieu d'espÃ©rance, quand tout semble sombre, rappelle-moi que tu as un plan parfait pour ma vie. Amen." },
            { title: "PriÃ¨re pour la foi", text: "Seigneur, augmente ma foi. Aide-moi Ã  te faire confiance mÃªme quand je ne comprends pas. Amen." },
            { title: "PriÃ¨re pour l'amour", text: "Dieu d'amour, remplis mon cÅ“ur de ton amour pour que je puisse aimer comme tu aimes. Amen." },
            { title: "PriÃ¨re pour la provision", text: "JÃ©hovah JirÃ©, tu es mon pourvoyeur. Je te fais confiance pour tous mes besoins. Amen." },
            { title: "PriÃ¨re pour la direction", text: "Saint-Esprit, guide-moi dans toutes mes dÃ©cisions. Montre-moi le chemin Ã  suivre. Amen." },
            { title: "PriÃ¨re pour la rÃ©conciliation", text: "PÃ¨re de misÃ©ricorde, aide-moi Ã  me rÃ©concilier avec ceux qui m'ont blessÃ©. Amen." },
            { title: "PriÃ¨re pour la puretÃ©", text: "Dieu saint, purifie mon cÅ“ur et mes pensÃ©es. Aide-moi Ã  vivre dans la saintetÃ©. Amen." },
            { title: "PriÃ¨re pour la persÃ©vÃ©rance", text: "Seigneur, donne-moi la force de persÃ©vÃ©rer dans les difficultÃ©s. Tu es ma force. Amen." },
            { title: "PriÃ¨re pour la compassion", text: "JÃ©sus compatissant, donne-moi un cÅ“ur de compassion pour ceux qui souffrent autour de moi. Amen." },
            { title: "PriÃ¨re pour la libertÃ©", text: "Dieu libÃ©rateur, brise les chaÃ®nes qui m'empÃªchent de te servir pleinement. Amen." },
            { title: "PriÃ¨re pour la croissance spirituelle", text: "PÃ¨re, aide-moi Ã  grandir dans la connaissance de ta Parole et dans la ressemblance Ã  Christ. Amen." },
            { title: "PriÃ¨re pour les ennemis", text: "Seigneur, bÃ©nis ceux qui me font du mal. Change leur cÅ“ur et le mien pour ton amour. Amen." },
            { title: "PriÃ¨re pour la crÃ©ativitÃ©", text: "Dieu crÃ©ateur, inspire-moi dans mon travail crÃ©atif. Que tout soit pour ta gloire. Amen." },
            { title: "PriÃ¨re pour l'unitÃ©", text: "JÃ©sus, que ton peuple soit un comme toi et le PÃ¨re Ãªtes un. Brise les divisions. Amen." },
            { title: "PriÃ¨re pour la terre", text: "CrÃ©ateur, aide-nous Ã  Ãªtre de bons intendants de la crÃ©ation que tu nous as confiÃ©e. Amen." },
            { title: "PriÃ¨re pour les orphelins", text: "PÃ¨re des orphelins, protÃ¨ge et pourvois aux besoins des enfants sans parents. Amen." },
            { title: "PriÃ¨re pour les veuves", text: "Dieu consolateur, rÃ©conforte les veuves et pourvois Ã  leurs besoins. Amen." },
            { title: "PriÃ¨re pour la justice", text: "Dieu juste, que ta justice rÃ¨gne sur la terre. DÃ©fends les opprimÃ©s et les faibles. Amen." },
            { title: "PriÃ¨re pour la rÃ©vÃ©lation", text: "Saint-Esprit, rÃ©vÃ¨le-moi les mystÃ¨res de ta Parole. Ouvre mes yeux spirituels. Amen." }
        ];

        const testimonies = [
            { title: "GuÃ©rison miraculeuse", text: "Dieu m'a guÃ©ri d'une maladie que les mÃ©decins ne pouvaient pas soigner. Sa grÃ¢ce est infinie ! ğŸ™" },
            { title: "Provision divine", text: "Quand j'Ã©tais dans le besoin, Dieu a pourvu de maniÃ¨re inattendue. Il est fidÃ¨le ! âœ¨" },
            { title: "Paix dans l'Ã©preuve", text: "MalgrÃ© les difficultÃ©s, Dieu m'a donnÃ© une paix qui surpasse toute intelligence. ğŸ’«" },
            { title: "Restauration familiale", text: "Dieu a restaurÃ© ma famille brisÃ©e. Rien n'est impossible avec Lui ! â¤ï¸" }
        ];

        let currentVerseGame = 0;
        let verseGameScore = 0;
        let verseStartTime = 0;

        function startVerseGame() {
            currentVerseGame = 0;
            verseGameScore = 0;
            verseStartTime = Date.now();
            showVerseGameQuestion();
        }

        function showVerseGameQuestion() {
            // SÃ©lectionner un verset alÃ©atoire pour un jeu infini
            const randomIndex = Math.floor(Math.random() * verseGameData.length);
            const verse = verseGameData[randomIndex];
            
            // Calculer le temps Ã©coulÃ©
            const currentTime = Date.now();
            const sessionTime = Math.floor((currentTime - verseStartTime) / 1000);
            const minutes = Math.floor(sessionTime / 60);
            const seconds = sessionTime % 60;
            
            createGameModal('Trouve le Verset Infini', `
                <div class="text-center mb-6">
                    <div class="text-4xl mb-4">ğŸ“œ</div>
                    <div class="flex justify-between items-center mb-4">
                        <div class="bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm">
                            Verset ${currentVerseGame + 1}
                        </div>
                        <div class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm">
                            â±ï¸ ${minutes}:${seconds.toString().padStart(2, '0')}
                        </div>
                    </div>
                </div>
                
                <div class="bg-gray-50 p-4 rounded-xl mb-6">
                    <p class="text-gray-800 italic">"${verse.incomplete}"</p>
                    <p class="text-sm text-gray-500 mt-2">${verse.ref}</p>
                </div>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2">Mot manquant :</label>
                    <input type="text" id="verseAnswer" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:outline-none" placeholder="Tapez le mot manquant..." data-correct="${verse.missing}">
                </div>
                
                <div class="flex justify-between items-center text-sm text-gray-500 mb-4">
                    <div>Score: ${verseGameScore}/${currentVerseGame}</div>
                    <div>PrÃ©cision: ${currentVerseGame > 0 ? Math.round((verseGameScore/currentVerseGame)*100) : 0}%</div>
                </div>
                
                <div class="space-y-3">
                    <button onclick="checkVerseAnswer()" class="w-full bg-purple-600 text-white py-3 rounded-xl font-bold interactive-btn">
                        âœ… VÃ©rifier
                    </button>
                    <button onclick="closeGameModal()" class="w-full bg-gray-100 text-gray-700 py-2 rounded-xl text-sm interactive-btn">
                        â¸ï¸ Pause
                    </button>
                </div>
            `);
            
            setTimeout(() => {
                const input = document.getElementById('verseAnswer');
                if (input) {
                    input.focus();
                    // Permettre validation avec EntrÃ©e
                    input.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            checkVerseAnswer();
                        }
                    });
                }
            }, 100);
        }

        function checkVerseAnswer() {
            const input = document.getElementById('verseAnswer');
            const userAnswer = input.value.toLowerCase().trim();
            const correctAnswer = input.dataset.correct.toLowerCase();
            
            if (userAnswer === correctAnswer) {
                verseGameScore++;
                showNotification('âœ… Excellent ! Bonne rÃ©ponse ! +1 point');
            } else {
                showNotification(`âŒ La bonne rÃ©ponse Ã©tait: ${input.dataset.correct}`);
            }
            
            currentVerseGame++;
            input.value = '';
            setTimeout(() => {
                showVerseGameQuestion(); // Continue infiniment
            }, 1500);
        }

        // Jeu de versets infini - plus de rÃ©sultats finaux

        // Jeu de MÃ©moire
        const memoryCards = ['ğŸ™', 'âœï¸', 'ğŸ“–', 'ğŸ•Šï¸', 'ğŸ‘¼', 'â­', 'ğŸ’’', 'ğŸº'];
        let memoryGameCards = [];
        let flippedCards = [];
        let memoryScore = 0;
        let memoryMoves = 0;

        let memoryStartTime = 0;
        let memoryGamesPlayed = 0;

        function startMemoryGame() {
            memoryGameCards = [...memoryCards, ...memoryCards].sort(() => Math.random() - 0.5);
            flippedCards = [];
            memoryScore = 0;
            memoryMoves = 0;
            if (memoryGamesPlayed === 0) {
                memoryStartTime = Date.now();
            }
            showMemoryGame();
        }

        function showMemoryGame() {
            // Calculer le temps Ã©coulÃ©
            const currentTime = Date.now();
            const sessionTime = Math.floor((currentTime - memoryStartTime) / 1000);
            const minutes = Math.floor(sessionTime / 60);
            const seconds = sessionTime % 60;
            
            const cardsHtml = memoryGameCards.map((card, index) => `
                <div class="memory-card w-16 h-16 bg-blue-500 rounded-xl flex items-center justify-center text-2xl cursor-pointer hover:bg-blue-600 transition-all interactive-btn" 
                     onclick="flipMemoryCard(${index})" 
                     data-index="${index}" 
                     data-card="${card}">
                    <span class="card-back">ğŸ¯</span>
                    <span class="card-front hidden">${card}</span>
                </div>
            `).join('');

            createGameModal('MÃ©moire Biblique Infinie', `
                <div class="text-center mb-6">
                    <div class="text-4xl mb-4">ğŸ§©</div>
                    <div class="flex justify-between items-center mb-4">
                        <div class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm">
                            Partie ${memoryGamesPlayed + 1}
                        </div>
                        <div class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm">
                            â±ï¸ ${minutes}:${seconds.toString().padStart(2, '0')}
                        </div>
                    </div>
                    <div class="flex justify-between text-sm text-gray-600">
                        <span>Paires: ${memoryScore}/8</span>
                        <span>Coups: ${memoryMoves}</span>
                    </div>
                </div>
                
                <div class="grid grid-cols-4 gap-3 mb-6">
                    ${cardsHtml}
                </div>
                
                <button onclick="closeGameModal()" class="w-full bg-gray-100 text-gray-700 py-2 rounded-xl text-sm interactive-btn">
                    â¸ï¸ Pause
                </button>
            `);
        }

        function flipMemoryCard(index) {
            if (flippedCards.length >= 2) return;
            
            const card = document.querySelector(`[data-index="${index}"]`);
            if (card.classList.contains('flipped')) return;
            
            card.classList.add('flipped');
            card.querySelector('.card-back').classList.add('hidden');
            card.querySelector('.card-front').classList.remove('hidden');
            
            flippedCards.push(index);
            
            if (flippedCards.length === 2) {
                memoryMoves++;
                setTimeout(checkMemoryMatch, 1000);
            }
        }

        function checkMemoryMatch() {
            const [first, second] = flippedCards;
            const firstCard = memoryGameCards[first];
            const secondCard = memoryGameCards[second];
            
            if (firstCard === secondCard) {
                memoryScore++;
                showNotification('âœ… Paire trouvÃ©e !');
                
                if (memoryScore === 8) {
                    setTimeout(showMemoryResults, 500);
                }
            } else {
                const cards = document.querySelectorAll('.memory-card.flipped');
                cards.forEach(card => {
                    if (flippedCards.includes(parseInt(card.dataset.index))) {
                        card.classList.remove('flipped');
                        card.querySelector('.card-back').classList.remove('hidden');
                        card.querySelector('.card-front').classList.add('hidden');
                    }
                });
            }
            
            flippedCards = [];
        }

        function showMemoryResults() {
            let performance = '';
            if (memoryMoves <= 12) performance = 'Parfait ! ğŸ†';
            else if (memoryMoves <= 20) performance = 'Excellent ! ğŸ‘';
            else performance = 'Bien jouÃ© ! ğŸ“–';
            
            memoryGamesPlayed++;
            showNotification(`${performance} Partie ${memoryGamesPlayed} terminÃ©e en ${memoryMoves} coups !`);
            
            // DÃ©marrer automatiquement une nouvelle partie aprÃ¨s 2 secondes
            setTimeout(() => {
                startMemoryGame();
            }, 2000);
        }

        // Jeu Devine le Personnage - Base Ã©tendue
        const characters = [
            { name: "MoÃ¯se", clues: ["J'ai libÃ©rÃ© le peuple d'IsraÃ«l", "J'ai reÃ§u les 10 commandements", "J'ai sÃ©parÃ© la mer Rouge"] },
            { name: "David", clues: ["J'Ã©tais berger", "J'ai vaincu Goliath", "J'ai Ã©crit des psaumes"] },
            { name: "NoÃ©", clues: ["J'ai construit une arche", "J'ai sauvÃ© les animaux", "J'ai survÃ©cu au dÃ©luge"] },
            { name: "Abraham", clues: ["Dieu m'a promis une descendance", "J'ai quittÃ© ma terre natale", "Je suis le pÃ¨re de la foi"] },
            { name: "Joseph", clues: ["J'ai interprÃ©tÃ© les rÃªves", "Mes frÃ¨res m'ont vendu", "J'ai gouvernÃ© l'Ã‰gypte"] },
            { name: "Daniel", clues: ["J'ai survÃ©cu dans la fosse aux lions", "J'ai interprÃ©tÃ© des visions", "J'ai refusÃ© la nourriture du roi"] },
            { name: "Jonas", clues: ["J'ai fui loin de Dieu", "Un poisson m'a avalÃ©", "J'ai prÃªchÃ© Ã  Ninive"] },
            { name: "Salomon", clues: ["J'ai demandÃ© la sagesse", "J'ai construit le temple", "J'ai Ã©crit des proverbes"] },
            { name: "Pierre", clues: ["J'Ã©tais pÃªcheur", "J'ai marchÃ© sur l'eau", "J'ai reniÃ© JÃ©sus trois fois"] },
            { name: "Paul", clues: ["J'ai persÃ©cutÃ© les chrÃ©tiens", "J'ai eu une vision sur le chemin", "J'ai Ã©crit de nombreuses lettres"] },
            { name: "Marie", clues: ["J'ai portÃ© le Sauveur", "Un ange m'a annoncÃ© la nouvelle", "J'Ã©tais vierge"] },
            { name: "Jean", clues: ["J'Ã©tais le disciple bien-aimÃ©", "J'ai Ã©crit l'Apocalypse", "J'ai reposÃ© sur le sein de JÃ©sus"] },
            { name: "Ã‰lie", clues: ["J'ai dÃ©fiÃ© les prophÃ¨tes de Baal", "J'ai Ã©tÃ© nourri par des corbeaux", "Je suis montÃ© au ciel"] },
            { name: "Samuel", clues: ["J'ai oint les rois", "Dieu m'a appelÃ© enfant", "J'Ã©tais juge et prophÃ¨te"] },
            { name: "Ruth", clues: ["J'ai suivi ma belle-mÃ¨re", "J'ai glanÃ© dans les champs", "Je suis devenue ancÃªtre de David"] }
        ];

        let currentCharacter = 0;
        let characterScore = 0;
        let currentClue = 0;
        let characterStartTime = 0;
        let currentCharacterData = null;

        function startCharacterGame() {
            currentCharacter = 0;
            characterScore = 0;
            currentClue = 0;
            characterStartTime = Date.now();
            showCharacterQuestion();
        }

        function showCharacterQuestion() {
            // SÃ©lectionner un personnage alÃ©atoire pour un jeu infini
            const randomIndex = Math.floor(Math.random() * characters.length);
            currentCharacterData = characters[randomIndex];
            currentClue = 0;
            
            // Calculer le temps Ã©coulÃ©
            const currentTime = Date.now();
            const sessionTime = Math.floor((currentTime - characterStartTime) / 1000);
            const minutes = Math.floor(sessionTime / 60);
            const seconds = sessionTime % 60;
            
            createGameModal('Devine le Personnage Infini', `
                <div class="text-center mb-6">
                    <div class="text-4xl mb-4">ğŸ­</div>
                    <div class="flex justify-between items-center mb-4">
                        <div class="bg-orange-100 text-orange-800 px-3 py-1 rounded-full text-sm">
                            Personnage ${currentCharacter + 1}
                        </div>
                        <div class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm">
                            â±ï¸ ${minutes}:${seconds.toString().padStart(2, '0')}
                        </div>
                    </div>
                </div>
                
                <div class="bg-gray-50 p-4 rounded-xl mb-6">
                    <div class="text-sm font-medium mb-2">Indice ${currentClue + 1}:</div>
                    <p class="text-gray-800 italic">"${currentCharacterData.clues[currentClue]}"</p>
                </div>
                
                <div class="mb-6">
                    <input type="text" id="characterAnswer" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-orange-500 focus:outline-none" placeholder="Qui suis-je ?" data-correct="${currentCharacterData.name}">
                </div>
                
                <div class="flex justify-between items-center text-sm text-gray-500 mb-4">
                    <div>Score: ${characterScore}/${currentCharacter}</div>
                    <div>PrÃ©cision: ${currentCharacter > 0 ? Math.round((characterScore/currentCharacter)*100) : 0}%</div>
                </div>
                
                <div class="space-y-3">
                    <button onclick="checkCharacterAnswer()" class="w-full bg-orange-600 text-white py-3 rounded-xl font-bold interactive-btn">
                        âœ… VÃ©rifier
                    </button>
                    <button onclick="showNextClue()" class="w-full bg-yellow-500 text-white py-3 rounded-xl font-bold interactive-btn">
                        ğŸ’¡ Indice suivant (${currentClue + 1}/${currentCharacterData.clues.length})
                    </button>
                    <button onclick="closeGameModal()" class="w-full bg-gray-100 text-gray-700 py-2 rounded-xl text-sm interactive-btn">
                        â¸ï¸ Pause
                    </button>
                </div>
            `);
            
            setTimeout(() => {
                const input = document.getElementById('characterAnswer');
                if (input) {
                    input.focus();
                    // Permettre validation avec EntrÃ©e
                    input.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            checkCharacterAnswer();
                        }
                    });
                }
            }, 100);
        }

        function checkCharacterAnswer() {
            const input = document.getElementById('characterAnswer');
            const userAnswer = input.value.toLowerCase().trim();
            const correctAnswer = input.dataset.correct.toLowerCase();
            
            if (userAnswer === correctAnswer) {
                const points = 3 - currentClue; // Plus de points si trouvÃ© rapidement
                characterScore += points;
                showNotification(`âœ… Bravo ! Bonne rÃ©ponse ! +${points} points`);
                currentCharacter++;
                input.value = '';
                setTimeout(() => {
                    showCharacterQuestion(); // Continue infiniment
                }, 1500);
            } else {
                showNotification('âŒ Mauvaise rÃ©ponse, essaie encore !');
            }
        }

        function showNextClue() {
            if (currentClue < currentCharacterData.clues.length - 1) {
                currentClue++;
                showCharacterQuestion();
            } else {
                showNotification('ğŸ’¡ Plus d\'indices disponibles ! Devine maintenant !');
            }
        }

        // Jeu de personnages infini - plus de rÃ©sultats finaux

        // Utilitaires pour les jeux
        function createGameModal(title, content) {
            const modal = document.createElement('div');
            modal.className = 'game-modal';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl p-6 max-w-sm w-full max-h-[80vh] overflow-y-auto">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold">${title}</h3>
                        <button onclick="closeGameModal()" class="text-2xl text-gray-400 interactive-btn">Ã—</button>
                    </div>
                    ${content}
                </div>
            `;
            document.body.appendChild(modal);
        }

        function closeGameModal() {
            const modal = document.querySelector('.game-modal');
            if (modal) modal.remove();
        }

        // ===== ADMIN PANEL =====
        let adminPassword = 'PrayLink2024!';
        let adminUnlocked = false;

        // Ã‰couter la combinaison Ctrl+Alt+B
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.altKey && e.key === 'b') {
                e.preventDefault();
                promptAdminPassword();
            }
        });

        function promptAdminPassword() {
            const password = prompt('ğŸ” Code d\'accÃ¨s administrateur :');
            if (password === adminPassword) {
                adminUnlocked = true;
                openAdminPanel();
                showNotification('ğŸ”“ AccÃ¨s administrateur accordÃ©');
            } else if (password !== null) {
                showNotification('âŒ Code incorrect');
            }
        }

        function openAdminPanel() {
            if (!adminUnlocked) {
                promptAdminPassword();
                return;
            }
            document.getElementById('adminPanel').style.display = 'block';
        }

        function closeAdminPanel() {
            document.getElementById('adminPanel').style.display = 'none';
        }

        // ===== GOOGLE SHEETS INTEGRATION =====
        async function sendToGoogleSheets(data) {
            if (!appConfig.scriptUrl || appConfig.scriptUrl.includes('YOUR_SCRIPT_ID')) {
                console.log('Google Sheets non configurÃ©. Le message est sauvegardÃ© localement.');
                saveToLocalStorage(data);
                return;
            }
            
            try {
                // IMPORTANT: 'no-cors' est retirÃ©. C'est la correction principale.
                // Google Apps Script gÃ¨re correctement la sÃ©curitÃ© (CORS) pour les applications dÃ©ployÃ©es.
                const response = await fetch(appConfig.scriptUrl, {
                    method: 'POST',
                    body: JSON.stringify(data)
                });
                
                // On attend une rÃ©ponse JSON de notre script pour confirmer le succÃ¨s.
                const result = await response.json();

                if (result.success) {
                    console.log('DonnÃ©es envoyÃ©es Ã  Google Sheets avec succÃ¨s.');
                } else {
                    // Le script a retournÃ© une erreur.
                    console.error('Erreur retournÃ©e par Google Sheets:', result.error);
                    showNotification('âŒ Erreur serveur. Message sauvegardÃ© localement.');
                    saveToLocalStorage(data); // Sauvegarde locale en cas d'Ã©chec.
                }
            } catch (error) {
                // Cela attrape les erreurs rÃ©seau ou si la rÃ©ponse n'est pas un JSON valide.
                console.error('Erreur rÃ©seau ou de parsing avec Google Sheets:', error);
                saveToLocalStorage(data); // Sauvegarde locale en cas d'Ã©chec.
                showNotification('âŒ Erreur rÃ©seau. Message sauvegardÃ© localement.');
            }
        }
        
        async function loadFromGoogleSheets(action, params = {}) {
            if (!appConfig.scriptUrl || appConfig.scriptUrl.includes('YOUR_SCRIPT_ID')) {
                console.log('Google Sheets non configurÃ©. Chargement depuis le stockage local.');
                return loadFromLocalStorage(action, params);
            }
            
            try {
                const url = new URL(appConfig.scriptUrl);
                url.searchParams.append('action', action);
                Object.keys(params).forEach(key => url.searchParams.append(key, params[key]));
                
                const response = await fetch(url.toString());
                if (!response.ok) {
                    throw new Error(`Erreur HTTP: ${response.status}`);
                }
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(`Erreur du script: ${data.error}`);
                }
                return data;
            } catch (error) {
                console.error('Erreur lors du chargement depuis Google Sheets:', error);
                showNotification('âš ï¸ Impossible de charger les messages du serveur.');
                return loadFromLocalStorage(action, params);
            }
        }
        
        function saveToLocalStorage(data) {
            const key = `praylink_${data.action}_${Date.now()}`;
            localStorage.setItem(key, JSON.stringify(data));
            
            // Garder seulement les 100 derniers Ã©lÃ©ments
            const keys = Object.keys(localStorage).filter(k => k.startsWith('praylink_'));
            if (keys.length > 100) {
                keys.sort().slice(0, keys.length - 100).forEach(k => localStorage.removeItem(k));
            }
        }
        
        function loadFromLocalStorage(action, params = {}) {
            const keys = Object.keys(localStorage).filter(k => k.startsWith(`praylink_${action}`));
            return keys.map(key => JSON.parse(localStorage.getItem(key))).filter(Boolean);
        }
        
        function saveConfig() {
            appConfig.name = document.getElementById('appName').value;
            appConfig.baseUrl = document.getElementById('baseUrl').value;
            appConfig.scriptUrl = document.getElementById('scriptUrl').value;
            appConfig.sheetId = document.getElementById('sheetId').value;
            
            localStorage.setItem('praylink_config', JSON.stringify(appConfig));
            updateUniversalLink();
            showNotification('ğŸ’¾ Configuration sauvegardÃ©e !');
        }

        // ===== GESTION DES ONGLETS ADMIN =====
        function showContentTab(tabName) {
            // Cacher tous les contenus
            document.querySelectorAll('.content-tab').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // RÃ©initialiser les styles des onglets
            document.querySelectorAll('[id$="Tab"]').forEach(tab => {
                tab.classList.remove('border-blue-500', 'text-blue-600');
                tab.classList.add('text-gray-500');
            });
            
            // Afficher le contenu sÃ©lectionnÃ©
            document.getElementById(tabName + 'Content').classList.remove('hidden');
            document.getElementById(tabName + 'Tab').classList.add('border-blue-500', 'text-blue-600');
            document.getElementById(tabName + 'Tab').classList.remove('text-gray-500');
        }

        function saveContent() {
            const questions = document.getElementById('predefinedQuestions').value;
            const verses = document.getElementById('bibleVerses').value;
            const quizQuestions = document.getElementById('quizQuestions').value;
            const verseGameData = document.getElementById('verseGameData').value;
            const prayersData = document.getElementById('prayersData').value;
            const testimoniesData = document.getElementById('testimoniesData').value;
            const charactersData = document.getElementById('charactersData').value;
            
            localStorage.setItem('praylink_questions', questions);
            localStorage.setItem('praylink_verses', verses);
            localStorage.setItem('praylink_quiz_questions', quizQuestions);
            localStorage.setItem('praylink_verse_game_data', verseGameData);
            localStorage.setItem('praylink_prayers_data', prayersData);
            localStorage.setItem('praylink_testimonies_data', testimoniesData);
            localStorage.setItem('praylink_characters_data', charactersData);
            
            // Recharger les donnÃ©es dans les jeux
            loadCustomContent();
            showNotification('ğŸ’¾ Tout le contenu sauvegardÃ© !');
        }

        function loadDefaultContent() {
            // Charger le contenu par dÃ©faut dans les champs
            document.getElementById('quizQuestions').value = generateDefaultQuizContent();
            document.getElementById('verseGameData').value = generateDefaultVerseGameContent();
            document.getElementById('prayersData').value = generateDefaultPrayersContent();
            document.getElementById('testimoniesData').value = generateDefaultTestimoniesContent();
            document.getElementById('charactersData').value = generateDefaultCharactersContent();
            showNotification('ğŸ”„ Contenu par dÃ©faut chargÃ© !');
        }

        function exportContent() {
            const content = {
                questions: document.getElementById('predefinedQuestions').value,
                verses: document.getElementById('bibleVerses').value,
                quizQuestions: document.getElementById('quizQuestions').value,
                verseGameData: document.getElementById('verseGameData').value,
                prayersData: document.getElementById('prayersData').value,
                testimoniesData: document.getElementById('testimoniesData').value,
                charactersData: document.getElementById('charactersData').value,
                timestamp: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(content, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `praylink-content-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
            showNotification('ğŸ“¤ Contenu exportÃ© !');
        }

        function importContent() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const content = JSON.parse(e.target.result);
                            
                            if (content.questions) document.getElementById('predefinedQuestions').value = content.questions;
                            if (content.verses) document.getElementById('bibleVerses').value = content.verses;
                            if (content.quizQuestions) document.getElementById('quizQuestions').value = content.quizQuestions;
                            if (content.verseGameData) document.getElementById('verseGameData').value = content.verseGameData;
                            if (content.prayersData) document.getElementById('prayersData').value = content.prayersData;
                            if (content.testimoniesData) document.getElementById('testimoniesData').value = content.testimoniesData;
                            if (content.charactersData) document.getElementById('charactersData').value = content.charactersData;
                            
                            showNotification('ğŸ“¥ Contenu importÃ© avec succÃ¨s !');
                        } catch (error) {
                            showNotification('âŒ Erreur lors de l\'importation');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        function loadCustomContent() {
            // Charger le contenu personnalisÃ© depuis localStorage
            const savedQuizQuestions = localStorage.getItem('praylink_quiz_questions');
            const savedVerseGameData = localStorage.getItem('praylink_verse_game_data');
            const savedPrayersData = localStorage.getItem('praylink_prayers_data');
            const savedTestimoniesData = localStorage.getItem('praylink_testimonies_data');
            const savedCharactersData = localStorage.getItem('praylink_characters_data');
            
            if (savedQuizQuestions) {
                try {
                    const customQuestions = parseQuizQuestions(savedQuizQuestions);
                    if (customQuestions.length > 0) {
                        quizQuestions.splice(0, quizQuestions.length, ...customQuestions);
                    }
                } catch (e) {
                    console.log('Erreur parsing quiz questions:', e);
                }
            }
            
            if (savedVerseGameData) {
                try {
                    const customVerseData = parseVerseGameData(savedVerseGameData);
                    if (customVerseData.length > 0) {
                        verseGameData.splice(0, verseGameData.length, ...customVerseData);
                    }
                } catch (e) {
                    console.log('Erreur parsing verse game data:', e);
                }
            }
            
            if (savedPrayersData) {
                try {
                    const customPrayers = parsePrayersData(savedPrayersData);
                    if (customPrayers.length > 0) {
                        prayers.splice(0, prayers.length, ...customPrayers);
                    }
                } catch (e) {
                    console.log('Erreur parsing prayers data:', e);
                }
            }
            
            if (savedTestimoniesData) {
                try {
                    const customTestimonies = parseTestimoniesData(savedTestimoniesData);
                    if (customTestimonies.length > 0) {
                        testimonies.splice(0, testimonies.length, ...customTestimonies);
                    }
                } catch (e) {
                    console.log('Erreur parsing testimonies data:', e);
                }
            }
            
            if (savedCharactersData) {
                try {
                    const customCharacters = parseCharactersData(savedCharactersData);
                    if (customCharacters.length > 0) {
                        characters.splice(0, characters.length, ...customCharacters);
                    }
                } catch (e) {
                    console.log('Erreur parsing characters data:', e);
                }
            }
        }

        // Fonctions de parsing
        function parseQuizQuestions(data) {
            return data.split('\n').filter(line => line.trim()).map(line => {
                const parts = line.split(' | ');
                if (parts.length === 3) {
                    const options = parts[1].split(',');
                    return {
                        question: parts[0],
                        options: options,
                        correct: parseInt(parts[2])
                    };
                }
                return null;
            }).filter(q => q !== null);
        }

        function parseVerseGameData(data) {
            return data.split('\n').filter(line => line.trim()).map(line => {
                const parts = line.split(' | ');
                if (parts.length === 3) {
                    return {
                        incomplete: parts[0],
                        missing: parts[1],
                        ref: parts[2]
                    };
                }
                return null;
            }).filter(v => v !== null);
        }

        function parsePrayersData(data) {
            return data.split('\n').filter(line => line.trim()).map(line => {
                const parts = line.split(' | ');
                if (parts.length === 2) {
                    return {
                        title: parts[0],
                        text: parts[1]
                    };
                }
                return null;
            }).filter(p => p !== null);
        }

        function parseTestimoniesData(data) {
            return data.split('\n').filter(line => line.trim()).map(line => {
                const parts = line.split(' | ');
                if (parts.length === 2) {
                    return {
                        title: parts[0],
                        text: parts[1]
                    };
                }
                return null;
            }).filter(t => t !== null);
        }

        function parseCharactersData(data) {
            return data.split('\n').filter(line => line.trim()).map(line => {
                const parts = line.split(' | ');
                if (parts.length === 2) {
                    return {
                        name: parts[0],
                        clues: parts[1].split(',')
                    };
                }
                return null;
            }).filter(c => c !== null);
        }

        // Fonctions pour gÃ©nÃ©rer le contenu par dÃ©faut
        function generateDefaultQuizContent() {
            return quizQuestions.slice(0, 10).map(q => 
                `${q.question} | ${q.options.join(',')} | ${q.correct}`
            ).join('\n');
        }

        function generateDefaultVerseGameContent() {
            return verseGameData.slice(0, 10).map(v => 
                `${v.incomplete} | ${v.missing} | ${v.ref}`
            ).join('\n');
        }

        function generateDefaultPrayersContent() {
            return prayers.slice(0, 10).map(p => 
                `${p.title} | ${p.text}`
            ).join('\n');
        }

        function generateDefaultTestimoniesContent() {
            return testimonies.slice(0, 5).map(t => 
                `${t.title} | ${t.text}`
            ).join('\n');
        }

        function generateDefaultCharactersContent() {
            return characters.slice(0, 10).map(c => 
                `${c.name} | ${c.clues.join(',')}`
            ).join('\n');
        }

        async function refreshStats() {
            showNotification('ğŸ”„ Chargement des statistiques...');
            
            try {
                const stats = await loadFromGoogleSheets('getStats');
                
                if (stats && stats.length > 0) {
                    const latestStats = stats[0];
                    document.getElementById('totalUsers').textContent = latestStats.users || 127;
                    document.getElementById('totalMessages').textContent = latestStats.messages || 1543;
                    document.getElementById('totalGames').textContent = latestStats.games || 892;
                    document.getElementById('totalShares').textContent = latestStats.shares || 2341;
                } else {
                    // Valeurs par dÃ©faut si pas de donnÃ©es
                    document.getElementById('totalUsers').textContent = Math.floor(Math.random() * 200) + 100;
                    document.getElementById('totalMessages').textContent = Math.floor(Math.random() * 2000) + 1000;
                    document.getElementById('totalGames').textContent = Math.floor(Math.random() * 1000) + 500;
                    document.getElementById('totalShares').textContent = Math.floor(Math.random() * 3000) + 2000;
                }
                
                showNotification('ğŸ“Š Statistiques actualisÃ©es !');
            } catch (error) {
                console.error('Erreur chargement stats:', error);
                showNotification('âŒ Erreur de chargement des stats');
            }
        }
        
        function saveGameStats(gameType, score, duration) {
            const gameData = {
                action: 'saveGameStats',
                gameType: gameType,
                score: score,
                duration: duration,
                player: username,
                timestamp: new Date().toISOString()
            };
            
            sendToGoogleSheets(gameData);
        }

        function exportData() {
            const data = {
                config: appConfig,
                stats: {
                    users: document.getElementById('totalUsers').textContent,
                    messages: document.getElementById('totalMessages').textContent,
                    games: document.getElementById('totalGames').textContent,
                    shares: document.getElementById('totalShares').textContent
                },
                timestamp: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `praylink-data-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
            showNotification('ğŸ“¥ DonnÃ©es exportÃ©es !');
        }

        function downloadApp() {
            const htmlContent = document.documentElement.outerHTML;
            const configuredHtml = htmlContent
                .replace(/appConfig = \{[^}]+\}/, `appConfig = ${JSON.stringify(appConfig)}`)
                .replace('let username = \'\';', `let username = '${username}';`)
                .replace('let profileEmoji = \'ğŸ™\';', `let profileEmoji = '${profileEmoji}';`);
            
            const blob = new Blob([configuredHtml], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = 'index.html';
            link.click();
            
            URL.revokeObjectURL(url);
            showNotification('ğŸ“± App tÃ©lÃ©chargÃ©e ! PrÃªte pour Vercel.');
        }

        function generateVercelConfig() {
            const vercelConfig = {
                "name": appConfig.name.toLowerCase().replace(/\s+/g, '-'),
                "version": 2,
                "builds": [
                    {
                        "src": "index.html",
                        "use": "@vercel/static"
                    }
                ],
                "routes": [
                    {
                        "src": "/u/(.*)",
                        "dest": "/index.html"
                    },
                    {
                        "src": "/(.*)",
                        "dest": "/index.html"
                    }
                ]
            };

            const packageJson = {
                "name": appConfig.name.toLowerCase().replace(/\s+/g, '-'),
                "version": "1.0.0",
                "description": "PrayLink - Messages anonymes bibliques",
                "main": "index.html",
                "scripts": {
                    "dev": "vercel dev",
                    "build": "echo 'Static build'",
                    "start": "vercel dev"
                },
                "keywords": ["praylink", "bible", "messages", "anonymes"],
                "author": "PrayLink Team"
            };

            // TÃ©lÃ©charger vercel.json
            const vercelBlob = new Blob([JSON.stringify(vercelConfig, null, 2)], { type: 'application/json' });
            const vercelUrl = URL.createObjectURL(vercelBlob);
            const vercelLink = document.createElement('a');
            vercelLink.href = vercelUrl;
            vercelLink.download = 'vercel.json';
            vercelLink.click();
            URL.revokeObjectURL(vercelUrl);

            // TÃ©lÃ©charger package.json
            setTimeout(() => {
                const packageBlob = new Blob([JSON.stringify(packageJson, null, 2)], { type: 'application/json' });
                const packageUrl = URL.createObjectURL(packageBlob);
                const packageLink = document.createElement('a');
                packageLink.href = packageUrl;
                packageLink.download = 'package.json';
                packageLink.click();
                URL.revokeObjectURL(packageUrl);
            }, 500);

            showNotification('âš¡ Configuration Vercel gÃ©nÃ©rÃ©e !');
        }

        function generateQR() {
            const link = `${appConfig.baseUrl}/u/${username}`;
            showNotification(`ğŸ“± QR Code pour: ${link}`);
        }
        
        function loadUserProfile() {
            const savedProfile = localStorage.getItem('praylink_userProfile');
            if (savedProfile) {
                try {
                    const userProfile = JSON.parse(savedProfile);
                    username = userProfile.username;
                    profileEmoji = userProfile.emoji;
                    
                    // Skip setup and go directly to the main page
                    goToPage('mainPage');
                    refreshInbox();
                    return true; // Profile loaded
                } catch (e) {
                    console.error("Failed to parse user profile", e);
                    localStorage.removeItem('praylink_userProfile');
                    return false; // Profile corrupted
                }
            }
            return false; // No profile found
        }

        function generateAppsScript() {
            const appsScriptCode = `
// PrayLink Google Apps Script
// Copiez ce code dans Google Apps Script et dÃ©ployez comme application web

function doPost(e) {
  try {
    const data = JSON.parse(e.postData.contents);
    const sheet = SpreadsheetApp.getActiveSpreadsheet();
    
    switch(data.action) {
      case 'sendMessage':
        return saveMessage(sheet, data);
      case 'saveGameStats':
        return saveGameStats(sheet, data);
      default:
        return ContentService.createTextOutput(JSON.stringify({error: 'Action inconnue'}));
    }
  } catch (error) {
    return ContentService.createTextOutput(JSON.stringify({error: error.toString()}));
  }
}

function doGet(e) {
  try {
    const action = e.parameter.action;
    const sheet = SpreadsheetApp.getActiveSpreadsheet();
    
    switch(action) {
      case 'getMessages':
        return getMessages(sheet, e.parameter);
      case 'getStats':
        return getStats(sheet);
      default:
        return ContentService.createTextOutput(JSON.stringify({error: 'Action inconnue'}));
    }
  } catch (error) {
    return ContentService.createTextOutput(JSON.stringify({error: error.toString()}));
  }
}

function saveMessage(sheet, data) {
  let messagesSheet = sheet.getSheetByName('Messages');
  if (!messagesSheet) {
    messagesSheet = sheet.insertSheet('Messages');
    messagesSheet.getRange(1, 1, 1, 6).setValues([['Timestamp', 'Recipient', 'Sender', 'Message', 'Context', 'ID']]);
  }
  
  const row = [
    data.timestamp,
    data.recipient,
    data.sender,
    data.message,
    data.context,
    Utilities.getUuid()
  ];
  
  messagesSheet.appendRow(row);
  
  return ContentService.createTextOutput(JSON.stringify({success: true}))
    .setMimeType(ContentService.MimeType.JSON);
}

function getMessages(sheet, params) {
  let messagesSheet = sheet.getSheetByName('Messages');
  if (!messagesSheet) {
    return ContentService.createTextOutput(JSON.stringify([]))
      .setMimeType(ContentService.MimeType.JSON);
  }
  
  const data = messagesSheet.getDataRange().getValues();
  const headers = data[0];
  const messages = [];
  
  for (let i = 1; i < data.length; i++) {
    const row = data[i];
    if (row[1] === params.recipient) { // Filtrer par destinataire
      messages.push({
        timestamp: row[0],
        recipient: row[1],
        sender: row[2],
        message: row[3],
        context: row[4],
        id: row[5]
      });
    }
  }
  
  // Trier par timestamp dÃ©croissant
  messages.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
  
  return ContentService.createTextOutput(JSON.stringify(messages))
    .setMimeType(ContentService.MimeType.JSON);
}

function saveGameStats(sheet, data) {
  let statsSheet = sheet.getSheetByName('GameStats');
  if (!statsSheet) {
    statsSheet = sheet.insertSheet('GameStats');
    statsSheet.getRange(1, 1, 1, 6).setValues([['Timestamp', 'Player', 'GameType', 'Score', 'Duration', 'ID']]);
  }
  
  const row = [
    data.timestamp,
    data.player,
    data.gameType,
    data.score,
    data.duration,
    Utilities.getUuid()
  ];
  
  statsSheet.appendRow(row);
  
  return ContentService.createTextOutput(JSON.stringify({success: true}))
    .setMimeType(ContentService.MimeType.JSON);
}

function getStats(sheet) {
  const stats = {
    users: getUniqueCount(sheet, 'Messages', 1), // Unique recipients
    messages: getTotalCount(sheet, 'Messages'),
    games: getTotalCount(sheet, 'GameStats'),
    shares: Math.floor(Math.random() * 1000) + 500 // SimulÃ© pour l'instant
  };
  
  return ContentService.createTextOutput(JSON.stringify([stats]))
    .setMimeType(ContentService.MimeType.JSON);
}

function getUniqueCount(sheet, sheetName, columnIndex) {
  const targetSheet = sheet.getSheetByName(sheetName);
  if (!targetSheet) return 0;
  
  const data = targetSheet.getDataRange().getValues();
  const uniqueValues = new Set();
  
  for (let i = 1; i < data.length; i++) {
    if (data[i][columnIndex]) {
      uniqueValues.add(data[i][columnIndex]);
    }
  }
  
  return uniqueValues.size;
}

function getTotalCount(sheet, sheetName) {
  const targetSheet = sheet.getSheetByName(sheetName);
  if (!targetSheet) return 0;
  
  return Math.max(0, targetSheet.getLastRow() - 1); // -1 pour exclure l'en-tÃªte
}

// Fonction pour initialiser les feuilles
function initializeSheets() {
  const sheet = SpreadsheetApp.getActiveSpreadsheet();
  
  // CrÃ©er feuille Messages
  let messagesSheet = sheet.getSheetByName('Messages');
  if (!messagesSheet) {
    messagesSheet = sheet.insertSheet('Messages');
    messagesSheet.getRange(1, 1, 1, 6).setValues([['Timestamp', 'Recipient', 'Sender', 'Message', 'Context', 'ID']]);
  }
  
  // CrÃ©er feuille GameStats
  let statsSheet = sheet.getSheetByName('GameStats');
  if (!statsSheet) {
    statsSheet = sheet.insertSheet('GameStats');
    statsSheet.getRange(1, 1, 1, 6).setValues([['Timestamp', 'Player', 'GameType', 'Score', 'Duration', 'ID']]);
  }
  
  return 'Feuilles initialisÃ©es avec succÃ¨s!';
}
`;
            
            // CrÃ©er et tÃ©lÃ©charger le fichier
            const blob = new Blob([appsScriptCode], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = 'PrayLink-AppsScript.gs';
            link.click();
            
            URL.revokeObjectURL(url);
            showNotification('ğŸ“‹ Code Apps Script gÃ©nÃ©rÃ© et tÃ©lÃ©chargÃ© !');
        }
        
        async function testConnection() {
            if (!appConfig.scriptUrl || appConfig.scriptUrl === 'https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec') {
                showNotification('âŒ Configurez d\'abord l\'URL Apps Script');
                return;
            }
            
            try {
                showNotification('ğŸ”— Test de connexion...');
                
                const testData = {
                    action: 'sendMessage',
                    recipient: 'test',
                    sender: 'System',
                    message: 'Test de connexion PrayLink',
                    context: 'Test',
                    timestamp: new Date().toISOString()
                };
                
                await sendToGoogleSheets(testData);
                showNotification('âœ… Connexion rÃ©ussie ! Google Sheets configurÃ©.');
            } catch (error) {
                showNotification('âŒ Erreur de connexion. VÃ©rifiez la configuration.');
                console.error('Erreur test connexion:', error);
            }
        }
        
        function createSampleSheet() {
            const sheetUrl = `https://docs.google.com/spreadsheets/d/${appConfig.sheetId || 'VOTRE_SHEET_ID'}/edit`;
            
            if (appConfig.sheetId && appConfig.sheetId !== 'YOUR_GOOGLE_SHEET_ID') {
                window.open(sheetUrl, '_blank');
                showNotification('ğŸ“„ Ouverture de votre Google Sheet...');
            } else {
                window.open('https://sheets.google.com/create', '_blank');
                showNotification('ğŸ“„ CrÃ©ation d\'un nouveau Google Sheet...');
            }
        }

        // ===== UTILITAIRES =====
        async function refreshInbox() {
            showNotification('ğŸ”„ Chargement des messages...');
            
            try {
                const messages = await loadFromGoogleSheets('getMessages', { recipient: username });
                displayMessages(messages);
                document.getElementById('messageCount').textContent = messages.length;
                showNotification('âœ… Messages chargÃ©s !');
            } catch (error) {
                console.error('Erreur chargement messages:', error);
                showNotification('âŒ Erreur de chargement');
            }
        }
        
        function displayMessages(messages) {
            const messagesList = document.getElementById('messagesList');
            
            if (!messages || messages.length === 0) {
                messagesList.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <div class="text-4xl mb-4">ğŸ“­</div>
                        <p>Aucun message pour le moment</p>
                        <p class="text-sm mt-2">Partage ton lien pour recevoir des messages !</p>
                    </div>
                `;
                return;
            }
            
            messagesList.innerHTML = messages.map(msg => {
                const timeAgo = getTimeAgo(new Date(msg.timestamp));
                const contextColor = getContextColor(msg.context);
                
                return `
                    <div class="bg-white rounded-2xl p-4 border border-gray-200">
                        <div class="flex items-start justify-between mb-2">
                            <div class="text-sm text-gray-500">${msg.sender} â€¢ ${timeAgo}</div>
                            <div class="text-xs ${contextColor} px-2 py-1 rounded-full">${msg.context}</div>
                        </div>
                        <p class="text-gray-800 mb-3">"${msg.message}"</p>
                        <button onclick="openResponsePage('${msg.sender}', '${msg.message.replace(/'/g, "\\'")}', '${msg.context}')" 
                                class="bg-purple-600 text-white px-4 py-2 rounded-full text-sm font-medium interactive-btn">
                            ğŸ’¬ RÃ©pondre
                        </button>
                    </div>
                `;
            }).join('');
        }
        
        function getContextColor(context) {
            const colors = {
                'Question': 'bg-blue-100 text-blue-800',
                'PriÃ¨re': 'bg-green-100 text-green-800',
                'Verset': 'bg-purple-100 text-purple-800',
                'TÃ©moignage': 'bg-orange-100 text-orange-800'
            };
            return colors[context] || 'bg-gray-100 text-gray-800';
        }
        
        function getTimeAgo(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 1) return 'Ã  l\'instant';
            if (diffMins < 60) return `il y a ${diffMins}min`;
            if (diffHours < 24) return `il y a ${diffHours}h`;
            if (diffDays < 7) return `il y a ${diffDays}j`;
            return date.toLocaleDateString('fr-FR');
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // ===== INITIALISATION =====
        document.addEventListener('DOMContentLoaded', function() {
            // Charger la configuration sauvegardÃ©e
            const savedConfig = localStorage.getItem('praylink_config');
            if (savedConfig) {
                appConfig = JSON.parse(savedConfig);
                document.getElementById('appName').value = appConfig.name;
                document.getElementById('baseUrl').value = appConfig.baseUrl;
                document.getElementById('scriptUrl').value = appConfig.scriptUrl;
                document.getElementById('sheetId').value = appConfig.sheetId || '';
            }
            
            // First, check if we are on a response page URL
            const isResponseUrl = checkUrlParams();

            // If it's not a response page, then try to load the user's profile
            // and show their dashboard.
            if (!isResponseUrl) { loadUserProfile(); }

            // Charger le contenu personnalisÃ©
            loadCustomContent();
            
            // PrÃ©-remplir les champs admin avec le contenu par dÃ©faut si vides
            setTimeout(() => {
                if (document.getElementById('quizQuestions').value === '') {
                    document.getElementById('quizQuestions').value = generateDefaultQuizContent();
                }
                if (document.getElementById('verseGameData').value === '') {
                    document.getElementById('verseGameData').value = generateDefaultVerseGameContent();
                }
                if (document.getElementById('prayersData').value === '') {
                    document.getElementById('prayersData').value = generateDefaultPrayersContent();
                }
                if (document.getElementById('testimoniesData').value === '') {
                    document.getElementById('testimoniesData').value = generateDefaultTestimoniesContent();
                }
                if (document.getElementById('charactersData').value === '') {
                    document.getElementById('charactersData').value = generateDefaultCharactersContent();
                }
            }, 100);
        });

        // ===== FONCTIONS DE PARTAGE =====
        function shareRandomVerse() {
            const randomVerse = bibleVerses[Math.floor(Math.random() * bibleVerses.length)];
            const shareText = `ğŸ“– Verset du jour :\n\n"${randomVerse.text}"\n\n${randomVerse.ref}\n\nğŸ™ Partage ton PrayLink : ${appConfig.baseUrl}/u/${username}`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Verset du jour - PrayLink',
                    text: shareText
                });
            } else {
                navigator.clipboard.writeText(shareText).then(() => {
                    showNotification('ğŸ“– Verset copiÃ© ! Partage-le maintenant.');
                });
            }
        }

        function shareRandomPrayer() {
            const randomPrayer = prayers[Math.floor(Math.random() * prayers.length)];
            const shareText = `ğŸ™ ${randomPrayer.title} :\n\n${randomPrayer.text}\n\nâœ¨ Partage tes demandes de priÃ¨re : ${appConfig.baseUrl}/u/${username}`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'PriÃ¨re du jour - PrayLink',
                    text: shareText
                });
            } else {
                navigator.clipboard.writeText(shareText).then(() => {
                    showNotification('ğŸ™ PriÃ¨re copiÃ©e ! Partage-la maintenant.');
                });
            }
        }

        function shareRandomTestimony() {
            const randomTestimony = testimonies[Math.floor(Math.random() * testimonies.length)];
            const shareText = `âœ¨ ${randomTestimony.title} :\n\n${randomTestimony.text}\n\nğŸ’« Partage ton tÃ©moignage : ${appConfig.baseUrl}/u/${username}`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'TÃ©moignage - PrayLink',
                    text: shareText
                });
            } else {
                navigator.clipboard.writeText(shareText).then(() => {
                    showNotification('âœ¨ TÃ©moignage copiÃ© ! Partage-le maintenant.');
                });
            }
        }

        // Gestion des paramÃ¨tres URL pour les rÃ©ponses
        function checkUrlParams() {
            const path = window.location.pathname;
            const match = path.match(/^\/u\/([^/]+)/); // Matches /u/username
            
            if (match) {
                const recipient = match[1];
                const urlParams = new URLSearchParams(window.location.search);
                const context = urlParams.get('context') || 'question';
                const message = urlParams.get('message');

                const defaultMessages = {
                    question: 'Pose-moi une question biblique !',
                    verse: 'Partage-moi un verset qui t\'a touchÃ©.',
                    prayer: 'Laisse une demande de priÃ¨re.',
                    testimony: 'Partage un tÃ©moignage pour m\'encourager.'
                };
                
                document.getElementById('responseRecipient').textContent = '@' + recipient;
                document.getElementById('originalMessage').textContent = '"' + (message || defaultMessages[context]) + '"';
                document.getElementById('responseContext').textContent = context.charAt(0).toUpperCase() + context.slice(1);
                
                // Cacher l'app principale et afficher la page de rÃ©ponse
                document.querySelector('.app-container').style.display = 'none';
                document.getElementById('responsePage').classList.remove('hidden');
                return true; // URL was handled
            }
            return false; // URL was not for responding
        }
    </script>
</html>
